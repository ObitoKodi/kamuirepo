import base64;exec base64.b64decode(
'IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KaW1wb3J0IHVybGxpYgppbXBvcnQgdXJsbGliMgppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHJlCmltcG9ydCBvcwppbXBvcnQgYmFzZTY0CmltcG9ydCB4Ym1jcGx1Z2luCmltcG9ydCB4Ym1jZ3VpCmltcG9ydCB4Ym1jYWRkb24KaW1wb3J0IHhibWN2ZnMKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgY29va2llbGliCmZyb20gQmVhdXRpZnVsU291cCBpbXBvcnQgQmVhdXRpZnVsU3RvbmVTb3VwLCBCZWF1dGlmdWxTb3VwLCBCZWF1dGlmdWxTT0FQCnRyeToKICAgIGltcG9ydCBqc29uCmV4Y2VwdDoKICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24KaW1wb3J0IHRpbWUKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBfRWRpdAoKTmZsID0gJycKRm9vdGJhbGwgPSAnJwpDcmlja2V0ID0gJycKVGVubmlzID0gJycgCkJveGluZyA9ICcnCkdvbGYgPSAnJwpNb3RvcnNwb3J0cyA9ICcnClJ1Z2J5ID0gJycKSG9ja2V5ID0gJycKTmJhID0gJycKRGFydHMgPSAnJwpXd2UgPSAnJwpIb3JzZV9SYWNpbmcgPSAnJwpVZmMgPSAnJwpCYXNlYmFsbCA9ICcnCgkKcmVzb2x2ZV91cmw9WycxZmljaGllci5jb20nLCAnYWxsZGVicmlkLmNvbScsICdhbGxteXZpZGVvcy5uZXQnLCAnYWxsdmlkLmNoJywgJ2F1ZW5naW5lLmNvbScsICdiZXN0c3RyZWFtcy5uZXQnLCAnYnJpc2tmaWxlLmNvbScsICdjYXN0YW1wLmNvbScsICdjbGlja251cGxvYWQuY29tJywgJ2NsaWNrbnVwbG9hZC5tZScsICdjbGlja251cGxvYWQubGluaycsICdjbG91ZHkuZWMnLCAnY2xvdWR6aWxsYS50bycsICduZW9kcml2ZS5jbycsICdjcnVuY2h5cm9sbC5jb20nLCAnZGFjbGlwcy5pbicsICdkYWNsaXBzLmNvbScsICdkYWlseW1vdGlvbi5jb20nLCAnZGl2eHN0YWdlLmV1JywgJ2RpdnhzdGFnZS5uZXQnLCAnZGl2eHN0YWdlLnRvJywgJ2NvdWxkdGltZS50bycsICdlY29zdHJlYW0udHYnLCAnZXhhc2hhcmUuY29tJywgJ2VzdHJlYW0udG8nLCAnZmFjZWJvb2suY29tJywgJ2Zhc3RwbGF5LmNjJywgJ2Zhc3RwbGF5LnRvJywgJ2Zhc3RwbGF5LnN4JywgJ2ZpbGVob290LmNvbScsICdmaWxlbnVrZS5jb20nLCAnZmlsZXB1cC5uZXQnLCAnZmlsbXNob3dvbmxpbmUubmV0JywgJ2ZsYXNoeC50dicsICdwbHVzLmdvb2dsZS5jb20nLCAnZ29vZ2xldmlkZW8uY29tJywgJ3BpY2FzYXdlYi5nb29nbGUuY29tJywgJ2dvb2dsZXVzZXJjb250ZW50LmNvbScsICdnb29nbGVkcml2ZS5jb20nLCAnZ29yaWxsYXZpZC5pbicsICdnb3JpbGxhdmlkLmNvbScsICdnb3JpbGxhdmlkLmluJywgJ2dyaWZ0aG9zdC5jb20nLCAnaHVnZWZpbGVzLm5ldCcsICdpZG93YXRjaC5uZXQnLCAnaW5kYXZpZGVvLmh1JywgJ2lzaGFyZWQuZXUnLCAnamV0bG9hZC50dicsICdraW5nZmlsZXMubmV0JywgJ2xldHdhdGNoLnVzJywgJ2xldHdhdGNoLnRvJywgJ3ZpZHNoYXJlLnVzJywgJ21haWwucnUnLCAnbXkubWFpbC5ydScsICd2aWRlb2FwaS5teS5tYWlsLnJ1JywgJ2FwaS52aWRlby5tYWlsLnJ1JywgJ21lZ2EtZGVicmlkLmV1JywgJ21lZ2FtcDQubmV0JywgJ21lcnNhbGFheWl0dGVuLmNvbScsICdtb3ZkaXZ4LmNvbScsICdtb3Zwb2QubmV0JywgJ21vdnBvZC5pbicsICdtb3ZzaGFyZS5uZXQnLCAnd2hvbGVjbG91ZC5uZXQnLCAnbXA0ZW5naW5lLmNvbScsICdtcDRzdHJlYW0uY29tJywgJ21wNHVwbG9hZC5jb20nLCAnbXl2aWRzdHJlYW0ubmV0JywgJ25vc3ZpZGVvLmNvbScsICdub3Nsb2NrZXIuY29tJywgJ2F1cm9yYXZpZC50bycsICdub3ZhbW92LmNvbScsICdub3d2aWRlby5zeCcsICdub3d2aWRlby5ldScsICdub3d2aWRlby5jaCcsICdub3d2aWRlby5zeCcsICdub3d2aWRlby5jbycsICdub3d2aWRlby5saScsICdub3d2aWRlby5lYycsICdub3d2aWRlby5hdCcsICdub3d2aWRlby5mbycsICdvay5ydScsICdvZG5va2xhc3NuaWtpLnJ1JywgJ29wZW5sb2FkLmlvJywgJ29wZW5sb2FkLmNvJywgJ3BsYXk0NC5uZXQnLCAncGxheWVkLnRvJywgJ3BsYXloZC52aWRlbycsICdwbGF5aGQuZm8nLCAncGxheXUubmV0JywgJ3BsYXl1Lm1lJywgJ3BsYXl3aXJlLmNvbScsICdQcmVtaXVtaXplLm1lJywgJ3ByaW1lc2hhcmUudHYnLCAncHJvbXB0ZmlsZS5jb20nLCAncHVyZXZpZC5jb20nLCAncmFwaWR2aWRlby53cycsICdyYXBpZHZpZGVvLmNvbScsICdyZy50bycsICdhcGkucmVhbC1kZWJyaWQuY29tJywgJ3ByZW1pdW0ucnBuZXQuYml6JywgJ3J1dHViZS5ydScsICdzaGFyZWQyLm1lJywgJ3NoYXJlZC5zeCcsICdzaGFyZXJlcG8uY29tJywgJ3NoYXJlc2l4LmNvbScsICdzaW1wbHktZGVicmlkLmNvbScsICdzcGVlZHBsYXkueHl6JywgJ3NwZWVkcGxheS51cycsICdzcGVlZHBsYXkzLnB3JywgJ3NwZWVkdmlkZW8ubmV0JywgJ3N0YWdldnUuY29tJywgJ3N0cmVhbWNsb3VkLmV1JywgJ3N0cmVhbWluLnRvJywgJ3N0cmVhbS5tb2UnLCAnc3RyZWFtYW5nby5jb20nLCAnc3RyZWFtY2hlcnJ5LmNvbScsICd0ZXJhbWl4ZXIuY29tJywgJ3RoZXZpZGVvLm1lJywgJ3RoZXZpZC5uZXQnLCAndGhldmlkZW9zLnR2JywgJ3RvbHRzZC1mZWwudGsnLCAndHJvbGx2aWQubmV0JywgJ3R1bmUucGsnLCAndHVzZmlsZXMubmV0JywgJ3R3aXRjaC50dicsICd1cDJzdHJlYW0uY29tJywgJ3VwbG9hZC5hZicsICd1cGxvYWRjLmNvbScsICd1cGxvYWRjLmNoJywgJ3phbGFhLmNvbScsICd1cGxvYWR4Lm9yZycsICd1cHRvYm94LmNvbScsICd1cHRvc3RyZWFtLmNvbScsICd1c2VyZmlsZXMuY29tJywgJ3VzZXJzY2xvdWQuY29tJywgJ3ZlZWhkLmNvbScsICd2ZW9oLmNvbScsICd2aWQuYWcnLCAndmlkYnVsbC5jb20nLCAndmlkY3JhenkubmV0JywgJ3VwbG9hZGNyYXp5Lm5ldCcsICd0aGV2aWRlb2JlZS50bycsICd2aWRlb2JveGVyLmNvJywgJ3ZpZGdnLnRvJywgJ3ZpZC5nZycsICd2aWRlb2h1dC50bycsICd2aWRlb21lZ2EudHYnLCAndmlkZW9yYWoudG8nLCAndmlkZW9yZXYuY2MnLCAndmlkZW9za3kudG8nLCAndmlkZW8udHQnLCAndmlkZW93ZWVkLmVzJywgJ2JpdHZpZC5zeCcsICd2aWRlb3dlZWQuY29tJywgJ3ZpZGVvd29vZC50dicsICdieXpvby5vcmcnLCAncGxheXBhbmRhLm5ldCcsICd2aWRlb3pvby5tZScsICd2aWRlb3dpbmcubWUnLCAndmlkZW93aW5nLm1lJywgJ2Vhc3l2aWRlby5tZScsICdwbGF5NDQubmV0JywgJ3BsYXliYi5tZScsICd2aWRlbzQ0Lm5ldCcsICd2aWRpby5zeCcsICd2aWRsb3gudHYnLCAndmlkLm1lJywgJ3ZpZHNwb3QubmV0JywgJ3ZpZHRvLm1lJywgJ3ZpZHVwLm1lJywgJ3ZpZHVwLm9yZycsICd2aWR6aS50dicsICd2aW1lby5jb20nLCAndml2by5zeCcsICd2ay5jb20nLCAndmtwYXNzLmNvbScsICd2b2Rsb2NrZXIuY29tJywgJ3ZzaGFyZS5pbycsICd2c2hhcmUuZXUnLCAnd2F0Y2hlcnMudG8nLCAnd2F0Y2hvbmxpbmUudG8nLCAnd2F0Y2h2aWRlby51cycsICd3YXRjaHZpZGVvMi51cycsICd3YXRjaHZpZGVvMy51cycsICd3YXRjaHZpZGVvNC51cycsICd3YXRjaHZpZGVvNS51cycsICd3YXRjaHZpZGVvNi51cycsICd3YXRjaHZpZGVvNy51cycsICd3YXRjaHZpZGVvOC51cycsICd3YXRjaHZpZGVvOS51cycsICd3ZXNoYXJlLm1lJywgJ3h2aWRzdGFnZS5jb20nLCAneW91bG9sLmJpeicsICdzaGl0bW92aWUuY29tJywgJ3lvdXJ1cGxvYWQuY29tJywgJ3lvdXR1YmUuY29tJywgJ3lvdXR1LmJlJywgJ3lvdXdhdGNoLm9yZycsICdhcGkuemV2ZXJhLmNvbScsICd6ZXR0YWhvc3QudHYnLCAnenN0cmVhbS50byddCmdfaWdub3JlU2V0UmVzb2x2ZWQ9WydwbHVnaW4udmlkZW8uZHJhbWFzb25saW5lJywncGx1Z2luLnZpZGVvLmY0bVRlc3RlcicsJ3BsdWdpbi52aWRlby5zaGFoaWRtYmNuZXQnLCdwbHVnaW4udmlkZW8uU3BvcnRzRGV2aWwnLCdwbHVnaW4uc3RyZWFtLnZhdWdobmxpdmUudHYnLCdwbHVnaW4udmlkZW8uWmVtVFYtc2hhbmknXQoKY2xhc3MgTm9SZWRpcmVjdGlvbih1cmxsaWIyLkhUVFBFcnJvclByb2Nlc3Nvcik6CiAgIGRlZiBodHRwX3Jlc3BvbnNlKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgIHJldHVybiByZXNwb25zZQogICBodHRwc19yZXNwb25zZSA9IGh0dHBfcmVzcG9uc2UKICAgICAgIAphZGRvbiA9IF9FZGl0LmFkZG9uCmFkZG9uX3ZlcnNpb24gPSBhZGRvbi5nZXRBZGRvbkluZm8oJ3ZlcnNpb24nKQpwcm9maWxlID0geGJtYy50cmFuc2xhdGVQYXRoKGFkZG9uLmdldEFkZG9uSW5mbygncHJvZmlsZScpLmRlY29kZSgndXRmLTgnKSkKaG9tZSA9IHhibWMudHJhbnNsYXRlUGF0aChhZGRvbi5nZXRBZGRvbkluZm8oJ3BhdGgnKS5kZWNvZGUoJ3V0Zi04JykpCmZhdm9yaXRlcyA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnZmF2b3JpdGVzJykKaGlzdG9yeSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnaGlzdG9yeScpCgpSRVYgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2xpc3RfcmV2aXNpb24nKQppY29uID0gb3MucGF0aC5qb2luKGhvbWUsICdpY29uLnBuZycpCkZBTkFSVCA9IG9zLnBhdGguam9pbihob21lLCAnZmFuYXJ0LmpwZycpCnNvdXJjZV9maWxlID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdzb3VyY2VfZmlsZScpCmZ1bmN0aW9uc19kaXIgPSBwcm9maWxlCmRlYnVnID0gYWRkb24uZ2V0U2V0dGluZygnZGVidWcnKQppZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpPT1UcnVlOgogICAgRkFWID0gb3BlbihmYXZvcml0ZXMpLnJlYWQoKQplbHNlOiBGQVYgPSBbXQppZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6CiAgICBTT1VSQ0VTID0gb3Blbihzb3VyY2VfZmlsZSkucmVhZCgpCmVsc2U6IFNPVVJDRVMgPSBbXQoKCmRlZiBhZGRvbl9sb2coc3RyaW5nKToKICAgIGlmIGRlYnVnID09ICd0cnVlJzoKICAgICAgICB4Ym1jLmxvZygiW2FkZG9uLmxpdmUuU2t5bmV0IExpc3RzLSVzXTogJXMiICUoYWRkb25fdmVyc2lvbiwgc3RyaW5nKSkKCgpkZWYgbWFrZVJlcXVlc3QodXJsLCBoZWFkZXJzPU5vbmUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgaGVhZGVycyBpcyBOb25lOgogICAgICAgICAgICAgICAgaGVhZGVycyA9IHsnVXNlci1hZ2VudCcgOiAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBXT1c2NDsgcnY6MTkuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xOS4wJ30KICAgICAgICAgICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCxOb25lLGhlYWRlcnMpCiAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkKICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLnJlYWQoKQogICAgICAgICAgICByZXNwb25zZS5jbG9zZSgpCiAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgZXhjZXB0IHVybGxpYjIuVVJMRXJyb3IsIGU6CiAgICAgICAgICAgIGFkZG9uX2xvZygnVVJMOiAnK3VybCkKICAgICAgICAgICAgaWYgaGFzYXR0cihlLCAnY29kZScpOgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgd2l0aCBlcnJvciBjb2RlIC0gJXMuJyAlIGUuY29kZSkKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKFNreW5ldCxXZSBmYWlsZWQgd2l0aCBlcnJvciBjb2RlIC0gIitzdHIoZS5jb2RlKSsiLDEwMDAwLCIraWNvbisiKSIpCiAgICAgICAgICAgIGVsaWYgaGFzYXR0cihlLCAncmVhc29uJyk6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1dlIGZhaWxlZCB0byByZWFjaCBhIHNlcnZlci4nKQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdSZWFzb246ICVzJyAlZS5yZWFzb24pCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihTa3luZXQsV2UgZmFpbGVkIHRvIHJlYWNoIGEgc2VydmVyLiAtICIrc3RyKGUucmVhc29uKSsiLDEwMDAwLCIraWNvbisiKSIpCgoJCQkJCmRlZiBTS2luZGV4KCk6CiAgICBhZGRvbl9sb2coIlNLaW5kZXgiKQogICAgZ2V0RGF0YShfRWRpdC5NYWluQmFzZSwnJykKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCQkKZGVmIE9wZW5fVXJsKHVybCk6CiAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsKQogICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3M7IFU7IFdpbmRvd3MgTlQgNS4xOyBlbi1HQjsgcnY6MS45LjAuMykgR2Vja28vMjAwODA5MjQxNyBGaXJlZm94LzMuMC4zJykKICAgIHJlc3BvbnNlID0gJycKICAgIGxpbmsgPSAnJwogICAgdHJ5OiAKICAgICAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpCiAgICAgICAgbGluaz1yZXNwb25zZS5yZWFkKCkKICAgICAgICByZXNwb25zZS5jbG9zZSgpCiAgICBleGNlcHQ6IHBhc3MKICAgIGlmIGxpbmsgIT0gJyc6CiAgICAgICAgcmV0dXJuIGxpbmsKICAgIGVsc2U6CiAgICAgICAgbGluayA9ICdPcGVuZWQnCiAgICAgICAgcmV0dXJuIGxpbmsKCQpkZWYgU2VhcmNoX2lucHV0KHVybCk6CiAgICBEaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICBTZWFyY2hfdGl0bGUgPSBEaWFsb2cuaW5wdXQoJ1NlYXJjaCcsIHR5cGU9eGJtY2d1aS5JTlBVVF9BTFBIQU5VTSkKICAgIFNlYXJjaF9uYW1lID0gU2VhcmNoX3RpdGxlLmxvd2VyKCkKICAgIGlmIFNlYXJjaF9uYW1lID09ICcnOgogICAgICAgIHBhc3MKICAgIGVsc2U6CiAgICAgICAgU2VhcmNoX2xvb3AoU2VhcmNoX25hbWUsdXJsKSAgICAKCQpkZWYgU2VhcmNoX2xvb3AoU2VhcmNoX25hbWUsdXJsKToKICAgIEhUTUwgPSBPcGVuX1VybCh1cmwpCiAgICBpZiBIVE1MICE9ICdGYWlsZWQnOgogICAgICAgIG1hdGNoID0gcmUuY29tcGlsZSgnPGNoYW5uZWw+Lis/PG5hbWU+KC4rPyk8L25hbWU+Lis/PHRodW1ibmFpbD4oLis/KTwvdGh1bWJuYWlsPi4rPzxleHRlcm5hbGxpbms+KC4rPyk8L2V4dGVybmFsbGluaz4uKz88ZmFuYXJ0PiguKz8pPC9mYW5hcnQ+Lis/PC9jaGFubmVsPicscmUuRE9UQUxMKS5maW5kYWxsKEhUTUwpCiAgICAgICAgZm9yIG5hbWUsaW1hZ2UsdXJsLGZhbmFydCBpbiBtYXRjaDoKICAgICAgICAgICAgaWYgbm90ICdodHRwOicgaW4gdXJsOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgU2VhcmNoX2xvb3AoU2VhcmNoX25hbWUsdXJsKQogICAgICAgIG1hdGNoMiA9IHJlLmNvbXBpbGUoJzx0aXRsZT4oLis/KTwvdGl0bGU+Lis/PGxpbms+KC4rPyk8L2xpbms+Lis/PHRodW1ibmFpbD4oLis/KTwvdGh1bWJuYWlsPi4rPzxmYW5hcnQ+KC4rPyk8L2ZhbmFydD4nLHJlLkRPVEFMTCkuZmluZGFsbChIVE1MKQogICAgICAgIGZvciBuYW1lLHVybCxpbWFnZSxmYW5hcnQgaW4gbWF0Y2gyOgogICAgICAgICAgICBpZiAnaHR0cDonIGluIHVybDoKICAgICAgICAgICAgICAgIGlmIFNlYXJjaF9uYW1lLmxvd2VyKCkgaW4gbmFtZS5sb3dlcigpOgogICAgICAgICAgICAgICAgICAgIGFkZExpbmsodXJsLCBuYW1lLGltYWdlLGZhbmFydCwnJywnJywnJywnJyxOb25lLCcnLDEpCgkJCgkJCmRlZiBnZXRTb3VyY2VzKCk6CiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKSA9PSBUcnVlOgogICAgICAgICAgICBhZGREaXIoJ0Zhdm9yaXRlcycsJ3VybCcsNCxvcy5wYXRoLmpvaW4oaG9tZSwgJ3Jlc291cmNlcycsICdmYXZvcml0ZS5wbmcnKSxGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygiYnJvd3NlX3htbF9kYXRhYmFzZSIpID09ICJ0cnVlIjoKICAgICAgICAgICAgYWRkRGlyKCdYTUwgRGF0YWJhc2UnLCdodHRwOi8veGJtY3BsdXMueGIuZnVucGljLmRlL3d3dy1kYXRhL2ZpbGVzeXN0ZW0vJywxNSxpY29uLEZBTkFSVCwnJywnJywnJywnJykKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJicm93c2VfY29tbXVuaXR5IikgPT0gInRydWUiOgogICAgICAgICAgICBhZGREaXIoJ0NvbW11bml0eSBGaWxlcycsJ2NvbW11bml0eV9maWxlcycsMTYsaWNvbixGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoaGlzdG9yeSkgPT0gVHJ1ZToKICAgICAgICAgICAgYWRkRGlyKCdTZWFyY2ggSGlzdG9yeScsJ2hpc3RvcnknLDI1LG9zLnBhdGguam9pbihob21lLCAncmVzb3VyY2VzJywgJ2Zhdm9yaXRlLnBuZycpLEZBTkFSVCwnJywnJywnJywnJykKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJzZWFyY2h5dCIpID09ICJ0cnVlIjoKICAgICAgICAgICAgYWRkRGlyKCdTZWFyY2g6WW91dHViZScsJ3lvdXR1YmUnLDI1LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoInNlYXJjaERNIikgPT0gInRydWUiOgogICAgICAgICAgICBhZGREaXIoJ1NlYXJjaDpkYWlseW1vdGlvbicsJ2Rtb3Rpb24nLDI1LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoIlB1bHNhck0iKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgIGFkZERpcignUHVsc2FyOklNREInLCdJTURCaWRwbGF5JywyNyxpY29uLEZBTkFSVCwnJywnJywnJywnJykgICAgICAgICAgICAKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6CiAgICAgICAgICAgIHNvdXJjZXMgPSBqc29uLmxvYWRzKG9wZW4oc291cmNlX2ZpbGUsInIiKS5yZWFkKCkpCiAgICAgICAgICAgICNwcmludCAnc291cmNlcycsc291cmNlcwogICAgICAgICAgICBpZiBsZW4oc291cmNlcykgPiAxOgogICAgICAgICAgICAgICAgZm9yIGkgaW4gc291cmNlczoKICAgICAgICAgICAgICAgICAgICAjIyBmb3IgcHJlIDEuMC44IHNvdXJjZXMKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGksIGxpc3QpOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIoaVswXS5lbmNvZGUoJ3V0Zi04JyksaVsxXS5lbmNvZGUoJ3V0Zi04JyksMSxpY29uLEZBTkFSVCwnJywnJywnJywnJywnc291cmNlJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICB0aHVtYiA9IGljb24KICAgICAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gRkFOQVJUCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2MgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIGdlbnJlID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCd0aHVtYm5haWwnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iID0gaVsndGh1bWJuYWlsJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdmYW5hcnQnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbmFydCA9IGlbJ2ZhbmFydCddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZGVzY3JpcHRpb24nKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2MgPSBpWydkZXNjcmlwdGlvbiddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZGF0ZScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGlbJ2RhdGUnXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2dlbnJlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5yZSA9IGlbJ2dlbnJlJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdjcmVkaXRzJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gaVsnY3JlZGl0cyddCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihpWyd0aXRsZSddLmVuY29kZSgndXRmLTgnKSxpWyd1cmwnXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYixmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLGNyZWRpdHMsJ3NvdXJjZScpCgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgbGVuKHNvdXJjZXMpID09IDE6CiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzb3VyY2VzWzBdLCBsaXN0KToKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YShzb3VyY2VzWzBdWzFdLmVuY29kZSgndXRmLTgnKSxGQU5BUlQpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YShzb3VyY2VzWzBdWyd1cmwnXSwgc291cmNlc1swXVsnZmFuYXJ0J10pCgoKZGVmIGFkZFNvdXJjZSh1cmw9Tm9uZSk6CiAgICAgICAgaWYgdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCJuZXdfZmlsZV9zb3VyY2UiKSA9PSAiIjoKICAgICAgICAgICAgICAgc291cmNlX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ25ld19maWxlX3NvdXJjZScpLmRlY29kZSgndXRmLTgnKQogICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCJuZXdfdXJsX3NvdXJjZSIpID09ICIiOgogICAgICAgICAgICAgICBzb3VyY2VfdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbmV3X3VybF9zb3VyY2UnKS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICBlbHNlOgogICAgICAgICAgICBzb3VyY2VfdXJsID0gdXJsCiAgICAgICAgaWYgc291cmNlX3VybCA9PSAnJyBvciBzb3VyY2VfdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGFkZG9uX2xvZygnQWRkaW5nIE5ldyBTb3VyY2U6ICcrc291cmNlX3VybC5lbmNvZGUoJ3V0Zi04JykpCgogICAgICAgIG1lZGlhX2luZm8gPSBOb25lCiAgICAgICAgI3ByaW50ICdzb3VyY2VfdXJsJyxzb3VyY2VfdXJsCiAgICAgICAgZGF0YSA9IGdldFNvdXAoc291cmNlX3VybCkKICAgICAgICBwcmludCAnc291cmNlX3VybCcsc291cmNlX3VybAogICAgICAgIGlmIGlzaW5zdGFuY2UoZGF0YSxCZWF1dGlmdWxTT0FQKToKICAgICAgICAgICAgaWYgZGF0YS5maW5kKCdjaGFubmVsc19pbmZvJyk6CiAgICAgICAgICAgICAgICBtZWRpYV9pbmZvID0gZGF0YS5jaGFubmVsc19pbmZvCiAgICAgICAgICAgIGVsaWYgZGF0YS5maW5kKCdpdGVtc19pbmZvJyk6CiAgICAgICAgICAgICAgICBtZWRpYV9pbmZvID0gZGF0YS5pdGVtc19pbmZvCiAgICAgICAgaWYgbWVkaWFfaW5mbzoKICAgICAgICAgICAgc291cmNlX21lZGlhID0ge30KICAgICAgICAgICAgc291cmNlX21lZGlhWyd1cmwnXSA9IHNvdXJjZV91cmwKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ3RpdGxlJ10gPSBtZWRpYV9pbmZvLnRpdGxlLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ3RodW1ibmFpbCddID0gbWVkaWFfaW5mby50aHVtYm5haWwuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZmFuYXJ0J10gPSBtZWRpYV9pbmZvLmZhbmFydC5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydnZW5yZSddID0gbWVkaWFfaW5mby5nZW5yZS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydkZXNjcmlwdGlvbiddID0gbWVkaWFfaW5mby5kZXNjcmlwdGlvbi5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydkYXRlJ10gPSBtZWRpYV9pbmZvLmRhdGUuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnY3JlZGl0cyddID0gbWVkaWFfaW5mby5jcmVkaXRzLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiAnLycgaW4gc291cmNlX3VybDoKICAgICAgICAgICAgICAgIG5hbWVTdHIgPSBzb3VyY2VfdXJsLnNwbGl0KCcvJylbLTFdLnNwbGl0KCcuJylbMF0KICAgICAgICAgICAgaWYgJ1xcJyBpbiBzb3VyY2VfdXJsOgogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHNvdXJjZV91cmwuc3BsaXQoJ1xcJylbLTFdLnNwbGl0KCcuJylbMF0KICAgICAgICAgICAgaWYgJyUnIGluIG5hbWVTdHI6CiAgICAgICAgICAgICAgICBuYW1lU3RyID0gdXJsbGliLnVucXVvdGVfcGx1cyhuYW1lU3RyKQogICAgICAgICAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQobmFtZVN0ciwnRGlzcGxheWVkIE5hbWUsIFJlbmFtZT8nKQogICAgICAgICAgICBrZXlib2FyZC5kb01vZGFsKCkKICAgICAgICAgICAgaWYgKGtleWJvYXJkLmlzQ29uZmlybWVkKCkgPT0gRmFsc2UpOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIG5ld1N0ciA9IGtleWJvYXJkLmdldFRleHQoKQogICAgICAgICAgICBpZiBsZW4obmV3U3RyKSA9PSAwOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYSA9IHt9CiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndGl0bGUnXSA9IG5ld1N0cgogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3VybCddID0gc291cmNlX3VybAogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ2ZhbmFydCddID0gZmFuYXJ0CgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09RmFsc2U6CiAgICAgICAgICAgIHNvdXJjZV9saXN0ID0gW10KICAgICAgICAgICAgc291cmNlX2xpc3QuYXBwZW5kKHNvdXJjZV9tZWRpYSkKICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlX2xpc3QpKQogICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQogICAgICAgICAgICBzb3VyY2VzLmFwcGVuZChzb3VyY2VfbWVkaWEpCiAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQogICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCduZXdfdXJsX3NvdXJjZScsICIiKQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ25ld19maWxlX3NvdXJjZScsICIiKQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKFNreW5ldCxOZXcgc291cmNlIGFkZGVkLiw1MDAwLCIraWNvbisiKSIpCiAgICAgICAgaWYgbm90IHVybCBpcyBOb25lOgogICAgICAgICAgICBpZiAneGJtY3BsdXMueGIuZnVucGljLmRlJyBpbiB1cmw6CiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5VcGRhdGUoJXM/bW9kZT0xNCxyZXBsYWNlKSIgJXN5cy5hcmd2WzBdKQogICAgICAgICAgICBlbGlmICdjb21tdW5pdHktbGlua3MnIGluIHVybDoKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlVwZGF0ZSglcz9tb2RlPTEwLHJlcGxhY2UpIiAlc3lzLmFyZ3ZbMF0pCiAgICAgICAgZWxzZTogYWRkb24ub3BlblNldHRpbmdzKCkKCQoKZGVmIHJtU291cmNlKG5hbWUpOgogICAgICAgIHNvdXJjZXMgPSBqc29uLmxvYWRzKG9wZW4oc291cmNlX2ZpbGUsInIiKS5yZWFkKCkpCiAgICAgICAgZm9yIGluZGV4IGluIHJhbmdlKGxlbihzb3VyY2VzKSk6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc291cmNlc1tpbmRleF0sIGxpc3QpOgogICAgICAgICAgICAgICAgaWYgc291cmNlc1tpbmRleF1bMF0gPT0gbmFtZToKICAgICAgICAgICAgICAgICAgICBkZWwgc291cmNlc1tpbmRleF0KICAgICAgICAgICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpCiAgICAgICAgICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQogICAgICAgICAgICAgICAgICAgIGIuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBzb3VyY2VzW2luZGV4XVsndGl0bGUnXSA9PSBuYW1lOgogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQogICAgICAgICAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlcykpCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5SZWZyZXNoIikKCgoKZGVmIGdldF94bWxfZGF0YWJhc2UodXJsLCBicm93c2U9RmFsc2UpOgogICAgICAgIGlmIHVybCBpcyBOb25lOgogICAgICAgICAgICB1cmwgPSAnaHR0cDovL3hibWNwbHVzLnhiLmZ1bnBpYy5kZS93d3ctZGF0YS9maWxlc3lzdGVtLycKICAgICAgICBzb3VwID0gQmVhdXRpZnVsU291cChtYWtlUmVxdWVzdCh1cmwpLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU291cC5IVE1MX0VOVElUSUVTKQogICAgICAgIGZvciBpIGluIHNvdXAoJ2EnKToKICAgICAgICAgICAgaHJlZiA9IGlbJ2hyZWYnXQogICAgICAgICAgICBpZiBub3QgaHJlZi5zdGFydHN3aXRoKCc/Jyk6CiAgICAgICAgICAgICAgICBuYW1lID0gaS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIG5hbWUgbm90IGluIFsnUGFyZW50IERpcmVjdG9yeScsICdyZWN5Y2xlX2Jpbi8nXToKICAgICAgICAgICAgICAgICAgICBpZiBocmVmLmVuZHN3aXRoKCcvJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJyb3dzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDE1LGljb24sZmFuYXJ0LCcnLCcnLCcnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTQsaWNvbixmYW5hcnQsJycsJycsJycpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBocmVmLmVuZHN3aXRoKCcueG1sJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJyb3dzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09VHJ1ZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuYW1lIGluIFNPVVJDRVM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lKycgKGluIHVzZSknLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKCgpkZWYgZ2V0Q29tbXVuaXR5U291cmNlcyhicm93c2U9RmFsc2UpOgogICAgICAgIHVybCA9ICdodHRwOi8vY29tbXVuaXR5LWxpbmtzLmdvb2dsZWNvZGUuY29tL3N2bi90cnVuay8nCiAgICAgICAgc291cCA9IEJlYXV0aWZ1bFNvdXAobWFrZVJlcXVlc3QodXJsKSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFNvdXAuSFRNTF9FTlRJVElFUykKICAgICAgICBmaWxlcyA9IHNvdXAoJ3VsJylbMF0oJ2xpJylbMTpdCiAgICAgICAgZm9yIGkgaW4gZmlsZXM6CiAgICAgICAgICAgIG5hbWUgPSBpKCdhJylbMF1bJ2hyZWYnXQogICAgICAgICAgICBpZiBicm93c2U6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwrbmFtZSwxLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwrbmFtZSwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQoKCmRlZiBnZXRTb3VwKHVybCxkYXRhPU5vbmUpOgogICAgICAgIHByaW50ICdnZXRzb3VwJyx1cmwsZGF0YQogICAgICAgIGlmIHVybC5zdGFydHN3aXRoKCdodHRwOi8vJykgb3IgdXJsLnN0YXJ0c3dpdGgoJ2h0dHBzOi8vJyk6CiAgICAgICAgICAgIGRhdGEgPSBtYWtlUmVxdWVzdCh1cmwpCiAgICAgICAgICAgIGlmIHJlLnNlYXJjaCgiI0VYVE0zVSIsZGF0YSkgb3IgJ20zdScgaW4gdXJsOiAKICAgICAgICAgICAgICAgIHByaW50ICdmb3VuZCBtM3UgZGF0YScsZGF0YQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgICAgIAogICAgICAgIGVsaWYgZGF0YSA9PSBOb25lOgogICAgICAgICAgICBpZiB4Ym1jdmZzLmV4aXN0cyh1cmwpOgogICAgICAgICAgICAgICAgaWYgdXJsLnN0YXJ0c3dpdGgoInNtYjovLyIpIG9yIHVybC5zdGFydHN3aXRoKCJuZnM6Ly8iKToKICAgICAgICAgICAgICAgICAgICBjb3B5ID0geGJtY3Zmcy5jb3B5KHVybCwgb3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JykpCiAgICAgICAgICAgICAgICAgICAgaWYgY29weToKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG9wZW4ob3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JyksICJyIikucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHhibWN2ZnMuZGVsZXRlKG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiZmFpbGVkIHRvIGNvcHkgZnJvbSBzbWI6IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG9wZW4odXJsLCAncicpLnJlYWQoKQogICAgICAgICAgICAgICAgICAgIGlmIHJlLm1hdGNoKCIjRVhUTTNVIixkYXRhKW9yICdtM3UnIGluIHVybDogCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdmb3VuZCBtM3UgZGF0YScsZGF0YQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCJTb3VwIERhdGEgbm90IGZvdW5kISIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICByZXR1cm4gQmVhdXRpZnVsU09BUChkYXRhLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU3RvbmVTb3VwLlhNTF9FTlRJVElFUykKCgpkZWYgZ2V0RGF0YSh1cmwsZmFuYXJ0KToKICAgIHByaW50ICd1cmwtZ2V0RGF0YScsdXJsCiAgICBTZXRWaWV3TGF5b3V0ID0gIkxpc3QiCiAgICAgCiAgICBzb3VwID0gZ2V0U291cCh1cmwpCiAgICAjcHJpbnQgdHlwZShzb3VwKQogICAgaWYgaXNpbnN0YW5jZShzb3VwLEJlYXV0aWZ1bFNPQVApOgogICAgICAgIGlmIGxlbihzb3VwKCdsYXlvdXR5cGUnKSkgPiAwOgogICAgICAgICAgICBTZXRWaWV3TGF5b3V0ID0gIlRodW1ibmFpbCIJCSAgICAKCiAgICAgICAgaWYgbGVuKHNvdXAoJ2NoYW5uZWxzJykpID4gMDoKICAgICAgICAgICAgY2hhbm5lbHMgPSBzb3VwKCdjaGFubmVsJykKICAgICAgICAgICAgZm9yIGNoYW5uZWwgaW4gY2hhbm5lbHM6CiMgICAgICAgICAgICAgICAgcHJpbnQgY2hhbm5lbAoKICAgICAgICAgICAgICAgIGxpbmtlZFVybD0nJwogICAgICAgICAgICAgICAgbGNvdW50PTAKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBsaW5rZWRVcmwgPSAgY2hhbm5lbCgnZXh0ZXJuYWxsaW5rJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgbGNvdW50PWxlbihjaGFubmVsKCdleHRlcm5hbGxpbmsnKSkKICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgI3ByaW50ICdsaW5rZWRVcmwnLGxpbmtlZFVybCxsY291bnQKICAgICAgICAgICAgICAgIGlmIGxjb3VudD4xOiBsaW5rZWRVcmw9JycKCiAgICAgICAgICAgICAgICBuYW1lID0gY2hhbm5lbCgnbmFtZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gY2hhbm5lbCgndGh1bWJuYWlsJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY2hhbm5lbCgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbCgnZmFuYXJ0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRlc2MgPSBjaGFubmVsKCdpbmZvJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGRlc2MgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRhdGUgPSBjaGFubmVsKCdkYXRlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGRhdGUgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gY2hhbm5lbCgnY3JlZGl0cycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGlmIGNyZWRpdHMgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgbGlua2VkVXJsPT0nJzoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx1cmwuZW5jb2RlKCd1dGYtOCcpLDIsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsY3JlZGl0cyxUcnVlKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5hbWUgPT0gJ1tDT0xPUiByZWRdTGl2ZSBTcG9ydFsvQ09MT1JdJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxsaW5rZWRVcmwuZW5jb2RlKCd1dGYtOCcpLDMxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJCQkJCSAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksbGlua2VkVXJsLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBkaXJlY3RvcnkgZnJvbSBnZXREYXRhKCk6ICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFkZG9uX2xvZygnTm8gQ2hhbm5lbHM6IGdldEl0ZW1zJykKICAgICAgICAgICAgZ2V0SXRlbXMoc291cCgnaXRlbScpLGZhbmFydCkKICAgIGVsc2U6CiAgICAgICAgcGFyc2VfbTN1KHNvdXApCgogICAgaWYgU2V0Vmlld0xheW91dCA9PSAiVGh1bWJuYWlsIjoKICAgICAgIFNldFZpZXdUaHVtYm5haWwoKQoJICAgCmRlZiBXaXpIRE1lbnUodXJsLGljb25pbWFnZSxmYW5hcnQpOgoJYWRkRGlyKCdTa3luZXQgUGxheWxpc3RlZCcsdXJsLDEsaWNvbmltYWdlLGZhbmFydCwnJywnJywnJyxOb25lLCdzb3VyY2UnKQoJaHRtbCA9IHJlcXVlc3RzLmdldCgnaHR0cDovL3dpemhkc3BvcnRzLmlzLycpLmNvbnRlbnQKCWJsb2NrID0gcmUuY29tcGlsZSgnPHVsIGNsYXNzPSJzcG9ydHNfbWVudSI+KC4rPyk8L3VsPicscmUuRE9UQUxMKS5maW5kYWxsKGh0bWwpCglmb3IgaXRlbSBpbiBibG9jazoKCQltYXRjaCA9IHJlLmNvbXBpbGUoJzxhIGhyZWY9IiguKz8pIi4rP3NyYz0iKC4rPykiLis/PiAoLis/KTwvbGk+JykuZmluZGFsbChzdHIoaXRlbSkpCgkJZm9yIHVybDIsaWNvbmltYWdlLG5hbWUgaW4gbWF0Y2g6CgkJCW5hbWUgPSBuYW1lLnRpdGxlKCkKCQkJaWYgbmFtZSA9PSAnTmZsJzppbWFnZSA9IE5mbAoJCQllbGlmIG5hbWUgPT0gJ0Zvb3RiYWxsJzppbWFnZSA9IEZvb3RiYWxsCgkJCWVsaWYgbmFtZSA9PSAnQ3JpY2tldCc6aW1hZ2UgPSBDcmlja2V0CgkJCWVsaWYgbmFtZSA9PSAnVGVubmlzJzppbWFnZSA9IFRlbm5pcwoJCQllbGlmIG5hbWUgPT0gJ0JveGluZyc6aW1hZ2UgPSBCb3hpbmcKCQkJZWxpZiBuYW1lID09ICdHb2xmJzppbWFnZSA9IEdvbGYKCQkJZWxpZiBuYW1lID09ICdNb3Rvc3BvcnRzJzppbWFnZSA9IE1vdG9yc3BvcnRzCgkJCWVsaWYgbmFtZSA9PSAnUnVnYnknOmltYWdlID0gUnVnYnkKCQkJZWxpZiBuYW1lID09ICdIb2NrZXknOmltYWdlID0gSG9ja2V5CgkJCWVsaWYgbmFtZSA9PSAnTmJhJzppbWFnZSA9IE5iYQoJCQllbGlmIG5hbWUgPT0gJ0RhcnRzJzppbWFnZSA9IERhcnRzCgkJCWVsaWYgbmFtZSA9PSAnV3dlJzppbWFnZSA9IFd3ZQoJCQllbGlmIG5hbWUgPT0gJ0hvcnNlIFJhY2luZyc6aW1hZ2UgPSBIb3JzZV9SYWNpbmcKCQkJZWxpZiBuYW1lID09ICdVZmMnOmltYWdlID0gVWZjCgkJCWVsaWYgbmFtZSA9PSAnQmFzZWJhbGwnOmltYWdlID0gQmFzZWJhbGwKCQkJaWYgbmFtZSA9PSAnVHYgU2hvd3MnOnBhc3MKCQkJZWxpZiBuYW1lID09ICdPdGhlcnMnOnBhc3MKCQkJZWxpZiBuYW1lID09ICdQMlAgT25saW5lJzpwYXNzCgkJCWVsc2U6CgkJCQlpZiBpbWFnZSA9PSAnJzoKCQkJCQlpbWFnZSA9IGljb25pbWFnZQoJCQkJYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLHVybDIuZW5jb2RlKCd1dGYtOCcpLDMyLGltYWdlLGZhbmFydCwnJywnJywnJyxOb25lLCdzb3VyY2UnKQoJCQkJCmRlZiBXaXpfR2V0X3VybCh1cmwpOgoJTGlzdCA9IFtdCgoJZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKCXRvZGF5c19kYXkgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJWQnKQoJdG9kYXlzX21vbnRoID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVtJykKCXRvZGF5c195ZWFyID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVZJykKCXRvZGF5c19ob3VyID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIJykKCXRvZGF5c19taW51dGUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJU0nKQoJZmluX2RhdGUgPSB0b2RheXNfZGF5KyctJyt0b2RheXNfbW9udGgrJy0nK3RvZGF5c195ZWFyCglodG1sID0gcmVxdWVzdHMuZ2V0KHVybCkuY29udGVudAoJYmxvY2sgPSByZS5jb21waWxlKCc8aDM+Lis/R2FtZXMgT24gOiAoLis/KTwvaDM+KC4rPyk8bGkgY2xhc3M9XCdzcG9ydHNfcmVkX2JhclwnPicscmUuRE9UQUxMKS5maW5kYWxsKGh0bWwpCglmb3IgZGF0ZSxyZXN0IGluIGJsb2NrOgoJCWlmIGRhdGUgPT0gZmluX2RhdGU6CgkJCW1hdGNoID0gcmUuY29tcGlsZSgnPGRpdiBjbGFzcz1cJ2NvbC1tZC0yXCc+Lis/PC9zcGFuPiguKz8pPC9kaXY+Lis/PGRpdiBjbGFzcz1cJ2NvbC1tZC02XCc+KC4rPyk8L2Rpdj4uKz9kaXYgY2xhc3M9ImNhcmQtYmxvY2sgZHJvcF9ib3giPiguKz8pPGRpdiBjbGFzcz0iY2FyZCI+JyxyZS5ET1RBTEwpLmZpbmRhbGwoc3RyKHJlc3QpKQoJCQlmb3IgdGltZSx0ZWFtcyxsaW5rX2Jsb2NrIGluIG1hdGNoOgoJCQkJdG90YWwgPSBsZW4obWF0Y2gpCgkJCQl0ZWFtcyA9IHRlYW1zLnJlcGxhY2UoJyAgJywnJykucmVwbGFjZSgnCScsJycpCgkJCQlsaW5rX2Jsb2NrID0gbGlua19ibG9jay5yZXBsYWNlKCcgICcsJycpCgkJCQl0aW1lX3NwbGl0ID0gcmUuZmluZGFsbCgnKC4rPyk6KC4rPyktKC4rPyk6KC4rPyk+JyxzdHIodGltZSsnPicpKQoJCQkJZm9yIHN0YXJ0X2hvdXIsc3RhcnRfbWluLGZpbl9ob3VyLGZpbl9taW4gaW4gdGltZV9zcGxpdDoKCQkJCQlzdGFydF9ubyA9IGludChzdGFydF9ob3VyKSoyNCtpbnQoc3RhcnRfbWluKQoJCQkJCWZpbl9ubyA9IGludChmaW5faG91cikqMjQraW50KGZpbl9taW4pCgkJCQkJdGltZV9ub3cgPSBpbnQodG9kYXlzX2hvdXIpKjI0K2ludCh0b2RheXNfbWludXRlKQoJCQkJCWlmIGZpbl9ubz50aW1lX25vdz5zdGFydF9ubzoKCQkJCQkJbmFtZSA9ICdbQ09MT1JncmVlbl0nKyB0ZWFtcysnWy9DT0xPUl0nCgkJCQkJZWxzZToKCQkJCQkJbmFtZSA9IHRlYW1zCgkJCQlsaW5rX2dldCA9IHJlLmNvbXBpbGUoIjxhIGhyZWY9JyguKz8pJz4uKz8+KC4rPyk8L2Rpdj48L2E+IikuZmluZGFsbChzdHIobGlua19ibG9jaykpCgkJCQlmb3IgbGluayxjaG5sIGluIGxpbmtfZ2V0OgoJCQkJCWxpbmsgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsLz9tb2RlPTEmYW1wO2l0ZW09Y2F0Y2hlciUzZHN0cmVhbXMlMjZ1cmw9JytsaW5rCgkJCQkJaWYgbGVuKGxpbmtfZ2V0KT4xOgoJCQkJCQlMaXN0LmFwcGVuZCgobGluayxjaG5sKSkKCQkJCQllbHNlOgoJCQkJCQlhZGRMaW5rKGxpbmssdGltZS5yZXBsYWNlKCcgJywnJykrJy0nK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSxpY29uLEZBTkFSVCwnJywnJywnJyxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQkJCQkJCQoJCQkJaWYgbGVuKExpc3QpPjE6CgkJCQkJdnVybCA9IHN0cihMaXN0KS5yZXBsYWNlKCdbJywnc3VibGluaycpLnJlcGxhY2UoJ10nLCcjJykucmVwbGFjZSgnc3VibGluayhcJycsJ3N1Ymxpbms6JykucmVwbGFjZSgncGx1Z2luOicsJ0xJU1RTT1VSQ0U6cGx1Z2luOicpLnJlcGxhY2UoIicsICciLCc6OkxJU1ROQU1FOicpLnJlcGxhY2UoIicpLCAoJyIsJzo6I3N1YmxpbmsnKS5yZXBsYWNlKCInKSIsJycpLnJlcGxhY2UoJ3N1YmxpbmtMSVNUU09VUkNFJywnc3VibGluazpMSVNUU09VUkNFJykKCQkJCQl4Ym1jLmxvZyh2dXJsKQoJCQkJCWFkZERpcih0aW1lLnJlcGxhY2UoJyAnLCcnKSsnLScrbmFtZSx2dXJsLDMwLGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQoJCQkJCWRlbCBMaXN0WzpdCgkJCgoKCQoKIyBib3Jyb3cgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZW5lbjkyL1AyUC1TdHJlYW1zLVhCTUMvYmxvYi9tYXN0ZXIvcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zL3Jlc291cmNlcy9jb3JlL2xpdmVzdHJlYW1zLnB5CiMgVGhpcyB3aWxsIG5vdCBnbyB0aHJvdWdoIHRoZSBnZXRJdGVtcyBmdW5jdGlvbnMgKCBtZWFucyB5b3UgbXVzdCBoYXZlIHJlYWR5IHRvIHBsYXkgdXJsLCBubyByZWdleCkKZGVmIHBhcnNlX20zdShkYXRhKToKICAgIGNvbnRlbnQgPSBkYXRhLnJzdHJpcCgpCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUocicjRVhUSU5GOiguKz8pLCguKj8pW1xuXHJdKyhbXlxuXSspJykuZmluZGFsbChjb250ZW50KQogICAgdG90YWwgPSBsZW4obWF0Y2gpCiAgICBwcmludCAndG90YWwgbTN1IGxpbmtzJyx0b3RhbAogICAgZm9yIG90aGVyLGNoYW5uZWxfbmFtZSxzdHJlYW1fdXJsIGluIG1hdGNoOgogICAgICAgIGlmICd0dmctbG9nbycgaW4gb3RoZXI6CiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlX21lKG90aGVyLCd0dmctbG9nbz1bXCciXSguKj8pW1wnIl0nKQogICAgICAgICAgICBpZiB0aHVtYm5haWw6CiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwuc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKSA9PSAiIjoKICAgICAgICAgICAgICAgICAgICBsb2dvX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gbG9nb191cmwgKyB0aHVtYm5haWwKCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAogICAgICAgICAgICAjZWxzZToKICAgICAgICAgICAgCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKICAgICAgICBpZiAndHlwZScgaW4gb3RoZXI6CiAgICAgICAgICAgIG1vZGVfdHlwZSA9IHJlX21lKG90aGVyLCd0eXBlPVtcJyJdKC4qPylbXCciXScpCiAgICAgICAgICAgIGlmIG1vZGVfdHlwZSA9PSAneXQtZGwnOgogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9IHN0cmVhbV91cmwgKyImbW9kZT0xOCIKICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ3JlZ2V4JzoKICAgICAgICAgICAgICAgIHVybCA9IHN0cmVhbV91cmwuc3BsaXQoJyZyZWdleHM9JykKICAgICAgICAgICAgICAgICNwcmludCB1cmxbMF0gZ2V0U291cCh1cmwsZGF0YT1Ob25lKQogICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgoZ2V0U291cCgnJyxkYXRhPXVybFsxXSkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBhZGRMaW5rKHN0cmVhbV91cmwsIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbCkKCQkKICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MCkiKQoJCmRlZiBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KToKICAgICAgICBzb3VwID0gZ2V0U291cCh1cmwpCiAgICAgICAgY2hhbm5lbF9saXN0ID0gc291cC5maW5kKCdjaGFubmVsJywgYXR0cnM9eyduYW1lJyA6IG5hbWUuZGVjb2RlKCd1dGYtOCcpfSkKICAgICAgICBpdGVtcyA9IGNoYW5uZWxfbGlzdCgnaXRlbScpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsX2xpc3QoJ2ZhbmFydCcpWzBdLnN0cmluZwogICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICBmb3IgY2hhbm5lbCBpbiBjaGFubmVsX2xpc3QoJ3N1YmNoYW5uZWwnKToKICAgICAgICAgICAgbmFtZSA9IGNoYW5uZWwoJ25hbWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gY2hhbm5lbCgndGh1bWJuYWlsJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBub3QgY2hhbm5lbCgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbCgnZmFuYXJ0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRlc2MgPSBjaGFubmVsKCdpbmZvJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGVzYyA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGdlbnJlID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRhdGUgPSBjaGFubmVsKCdkYXRlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGF0ZSA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjcmVkaXRzID0gY2hhbm5lbCgnY3JlZGl0cycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgY3JlZGl0cyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx1cmwuZW5jb2RlKCd1dGYtOCcpLDMsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGNyZWRpdHMsZGF0ZSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBkaXJlY3RvcnkgLSAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5BcnQpCgoKZGVmIGdldFN1YkNoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpOgogICAgICAgIHNvdXAgPSBnZXRTb3VwKHVybCkKICAgICAgICBjaGFubmVsX2xpc3QgPSBzb3VwLmZpbmQoJ3N1YmNoYW5uZWwnLCBhdHRycz17J25hbWUnIDogbmFtZS5kZWNvZGUoJ3V0Zi04Jyl9KQogICAgICAgIGl0ZW1zID0gY2hhbm5lbF9saXN0KCdzdWJpdGVtJykKICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5hcnQpCgojaGFrYW1hYwpkZWYgR2V0U3VibGlua3MobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCk6CiAgICB4Ym1jLmxvZygnSSBHT1QgSEVSRSMjIyMjIyMjIyMjIyMjIycpCiAgICBMaXN0PVtdOyBMaXN0VT1bXTsgYz0wCiAgICBhbGxfdmlkZW9zID0gcmVnZXhfZ2V0X2FsbCh1cmwsICdzdWJsaW5rOicsICcjJykKICAgIGZvciBhIGluIGFsbF92aWRlb3M6CiAgICAgICAgaWYgJ0xJU1RTT1VSQ0U6JyBpbiBhOgogICAgICAgICAgICB2dXJsID0gcmVnZXhfZnJvbV90byhhLCAnTElTVFNPVVJDRTonLCAnOjonKQogICAgICAgICAgICBsaW5lbmFtZSA9IHJlZ2V4X2Zyb21fdG8oYSwgJ0xJU1ROQU1FOicsICc6OicpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdnVybCA9IGEucmVwbGFjZSgnc3VibGluazonLCcnKS5yZXBsYWNlKCcjJywnJykKICAgICAgICAgICAgbGluZW5hbWUgPSBuYW1lCiAgICAgICAgaWYgbGVuKHZ1cmwpID4gMTA6CiAgICAgICAgICAgIGM9YysxOyBMaXN0LmFwcGVuZChsaW5lbmFtZSk7IExpc3RVLmFwcGVuZCh2dXJsKQogCiAgICBpZiBjPT0xOgogICAgICAgIHRyeToKICAgICAgICAgICAgI3ByaW50ICdwbGF5IDEgICBOYW1lOicgKyBuYW1lICsgJyAgIHVybDonICsgTGlzdFVbMF0gKyAnICAgICAnICsgc3RyKGMpCiAgICAgICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UsdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKTsgbGl6LnNldEluZm8oIHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUgfSApCiAgICAgICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9TGlzdFVbMF0sbGlzdGl0ZW09bGl6KQogICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsc29sdmVyKExpc3RVWzBdKSwgbGl6KQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgZWxzZToKICAgICAgICAgZGlhbG9nPXhibWNndWkuRGlhbG9nKCkKICAgICAgICAgck5vPWRpYWxvZy5zZWxlY3QoJ1NreW5ldCBTZWxlY3QgQSBTb3VyY2UnLCBMaXN0KQogICAgICAgICBpZiByTm8+PTA6CiAgICAgICAgICAgICByTmFtZT1uYW1lCiAgICAgICAgICAgICByVVJMPXN0cihMaXN0VVtyTm9dKQogICAgICAgICAgICAgI3ByaW50ICdTdWJsaW5rcyAgIE5hbWU6JyArIG5hbWUgKyAnICAgdXJsOicgKyByVVJMCiAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihyVVJMKSwgeGJtY2d1aS5MaXN0SXRlbShyTmFtZSkpCiAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHJVUkwsIHhibWNndWkuTGlzdEl0ZW0ock5hbWUpKQoKCQkJCQpkZWYgU2VhcmNoQ2hhbm5lbHMoKToKI2hha2FtYWMgY29kZQogICAgS2V5Ym9hcmRNZXNzYWdlID0gJ05hbWUgb2YgY2hhbm5lbCBzaG93IG9yIG1vdmllJwogICAgU2VhcmNoa2V5ID0gJycKICAgIGtleWJvYXJkID0geGJtYy5LZXlib2FyZChTZWFyY2hrZXksIEtleWJvYXJkTWVzc2FnZSkKICAgIGtleWJvYXJkLmRvTW9kYWwoKQogICAgaWYga2V5Ym9hcmQuaXNDb25maXJtZWQoKToKICAgICAgIFNlYXJjaGtleSA9IGtleWJvYXJkLmdldFRleHQoKS5yZXBsYWNlKCdcbicsJycpLnN0cmlwKCkKICAgICAgIGlmIGxlbihTZWFyY2hrZXkpID09IDA6IAogICAgICAgICAgeGJtY2d1aS5EaWFsb2coKS5vaygnUm9iaW5Ib29kJywgJ05vdGhpbmcgRW50ZXJlZCcpCiAgICAgICAgICByZXR1cm4JICAgCiAgICAKICAgIFNlYXJjaGtleSA9IFNlYXJjaGtleS5sb3dlcigpCiAgICBMaXN0PVtdCiAgICBMaXN0LmFwcGVuZChfRWRpdC5NYWluQmFzZSkKICAgIFBhc3NlZFVybHMgPSAwCiAgICBGb3VuZENoYW5uZWwgPSAxIAogICAgUmVhZENoYW5uZWwgPSAwCiAgICBGb3VuZE1hdGNoID0gMAogICAgcHJvZ3Jlc3MgPSB4Ym1jZ3VpLkRpYWxvZ1Byb2dyZXNzKCkKICAgIHByb2dyZXNzLmNyZWF0ZSgnU2t5bmV0IFNlYXJjaGluZyBQbGVhc2Ugd2FpdCcsJyAnKQoJCiAgICB3aGlsZSBGb3VuZENoYW5uZWwgPD4gUmVhZENoYW5uZWw6CiAgICAgICAgQmFzZVNlYXJjaCA9IExpc3RbUmVhZENoYW5uZWxdLnN0cmlwKCkKICAgICAgICBwcmludCAncmVhZCB0aGlzIG9uZSBmcm9tIGZpbGUgbGlzdCAoJyArIHN0cihSZWFkQ2hhbm5lbCkgKyAnKScgIAogICAgICAgIFJlYWRDaGFubmVsID0gUmVhZENoYW5uZWwgKyAxCgogICAgICAgIFBhZ2VTb3VyY2UgPSAnJwogICAgICAgIHRyeToKICAgICAgICAgICAgUGFnZVNvdXJjZSA9IG5ldC5odHRwX0dFVChCYXNlU2VhcmNoKS5jb250ZW50CiAgICAgICAgICAgIFBhZ2VTb3VyY2UgPSBQYWdlU291cmNlLmVuY29kZSgnYXNjaWknLCAnaWdub3JlJykuZGVjb2RlKCdhc2NpaScpCiAgICAgICAgICAgICN0aW1lLnNsZWVwKDEpCiAgICAgICAgZXhjZXB0OiAKICAgICAgICAgICAgcGFzcwoJCQogICAgICAgIGlmIGxlbihQYWdlU291cmNlKSA8IDEwOgogICAgICAgICAgICBQYWdlU291cmNlID0gJycKICAgICAgICAgICAgUGFzc2VkVXJscyA9IFBhc3NlZFVybHMgKyAxCiAgICAgICAgICAgIHByaW50ICcqKiogUEFTU0VEICoqKionICsgQmFzZVNlYXJjaCArICcgICoqKioqKioqKioqKiogVG90YWwgUGFzc2VkIFVybHM6ICcgKyBzdHIoUGFzc2VkVXJscykKICAgICAgICAgICAgdGltZS5zbGVlcCguNSkKIAogICAgICAgIHBlcmNlbnQgPSBpbnQoICggUmVhZENoYW5uZWwgLyAzMDApICogMTAwKSAKICAgICAgICBtZXNzYWdlID0gJyAgICAgUGFnZXMgUmVhZDogJytzdHIoUmVhZENoYW5uZWwpKycgICAgICAgIE1hdGNoZXMgRm91bmQ6ICcgKyBzdHIoRm91bmRNYXRjaCkKICAgICAgICBwcm9ncmVzcy51cGRhdGUocGVyY2VudCwiIiwgbWVzc2FnZSwgIiIgKQoKICAgICAgICBpZiBwcm9ncmVzcy5pc2NhbmNlbGVkKCk6CiAgICAgICAgICAgcmV0dXJuCiAJCQogICAgICAgIGlmIGxlbihQYWdlU291cmNlKSA+IDEwOgogICAgICAgICAgICBhbGxfbGlua3MgPSByZWdleF9nZXRfYWxsKFBhZ2VTb3VyY2UsICc8Y2hhbm5lbD4nLCAnPC9jaGFubmVsPicpCiAgICAgICAgICAgIGZvciBhIGluIGFsbF9saW5rczoKICAgICAgICAgICAgICAgIHZ1cmwgPSByZWdleF9mcm9tX3RvKGEsICc8ZXh0ZXJuYWxsaW5rPicsICc8L2V4dGVybmFsbGluaz4nKQogICAgICAgICAgICAgICAgI25hbWUgPSByZWdleF9mcm9tX3RvKGEsICc8bmFtZT4nLCAnPC9uYW1lPicpCiAgICAgICAgICAgICAgICAjcHJpbnQgbmFtZSArICcgICAgJyArIHZ1cmwKICAgICAgICAgICAgICAgIGlmIGxlbih2dXJsKSA+IDU6CiAgICAgICAgICAgICAgICAgICBGb3VuZENoYW5uZWwgPSBGb3VuZENoYW5uZWwgKyAxCiAgICAgICAgICAgICAgICAgICBMaXN0LmFwcGVuZCh2dXJsKQogICAgICAgICAgICAgICAgICAgI3ByaW50ICdGb3VuZCBDaGFubmVsOiAnKyBzdHIoRm91bmRDaGFubmVsKSArJyA6ICcrIHZ1cmwgCgogICAgICAgICAgICBhbGxfaXRlbXMgPSByZWdleF9nZXRfYWxsKFBhZ2VTb3VyY2UsICc8aXRlbT4nLCAnPC9pdGVtPicpCiAgICAgICAgICAgIGZvciBhIGluIGFsbF9pdGVtczoKICAgICAgICAgICAgICAgIHZ1cmwgPSByZWdleF9mcm9tX3RvKGEsICc8bGluaz4nLCAnPC9saW5rPicpCiAgICAgICAgICAgICAgICBuYW1lID0gcmVnZXhfZnJvbV90byhhLCAnPHRpdGxlPicsICc8L3RpdGxlPicpCiAgICAgICAgICAgICAgICBUZXN0TmFtZSA9ICcgICcgKyBuYW1lLmxvd2VyKCkgKyAnICAnCiAgICAgICAgICAgICAgICAjcHJpbnQgJ1Rlc3Rpbmc6JyArIFRlc3ROYW1lICsgJyAgJyArIFNlYXJjaGtleQogICAgICAgICAgICAgICAgaWYgbGVuKHZ1cmwpID4gNSBhbmQgVGVzdE5hbWUuZmluZChTZWFyY2hrZXkpID4gMDoKICAgICAgICAgICAgICAgICAgICBGb3VuZE1hdGNoID0gRm91bmRNYXRjaCArIDEKICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSAnJwogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlZ2V4X2Zyb21fdG8oYSwgJzx0aHVtYm5haWw+JywgJzwvdGh1bWJuYWlsPicpCiAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gcmVnZXhfZnJvbV90byhhLCAnPGZhbmFydD4nLCAnPC9mYW5hcnQ+JykKICAgICAgICAgICAgICAgICAgICBpZiBsZW4oZmFuYXJ0KSA8IDU6CiAgICAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gaWNvbgogICAgICAgICAgICAgICAgICAgIGlmIHZ1cmwuZmluZCgnc3VibGluaycpID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdnVybCwzMCx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLCcnKQogICAgICAgICAgICAgICAgICAgIGVsc2U6IAogICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKHN0cih2dXJsKSxuYW1lLHRodW1ibmFpbCxmYW5hcnQsJycsJycsJycsVHJ1ZSxOb25lLCcnLDEpCgkJCQkJCQogICAgCiAgICBwcm9ncmVzcy5jbG9zZSgpCiAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTApIikKCQpkZWYgU2VhcmNoX20zdShkYXRhLFNlYXJjaGtleSk6CiAgICBjb250ZW50ID0gZGF0YS5yc3RyaXAoKQogICAgbWF0Y2ggPSByZS5jb21waWxlKHInI0VYVElORjooLis/KSwoLio/KVtcblxyXSsoW15cbl0rKScpLmZpbmRhbGwoY29udGVudCkKICAgIHRvdGFsID0gbGVuKG1hdGNoKQogICAgcHJpbnQgJ3RvdGFsIG0zdSBsaW5rcycsdG90YWwKICAgIGZvciBvdGhlcixjaGFubmVsX25hbWUsc3RyZWFtX3VybCBpbiBtYXRjaDoKICAgICAgICBpZiAndHZnLWxvZ28nIGluIG90aGVyOgogICAgICAgICAgICB0aHVtYm5haWwgPSByZV9tZShvdGhlciwndHZnLWxvZ289W1wnIl0oLio/KVtcJyJdJykKICAgICAgICAgICAgaWYgdGh1bWJuYWlsOgogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygnbG9nby1mb2xkZXJQYXRoJykgPT0gIiI6CiAgICAgICAgICAgICAgICAgICAgbG9nb191cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGxvZ29fdXJsICsgdGh1bWJuYWlsCgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwKICAgICAgICAgICAgI2Vsc2U6CiAgICAgICAgICAgIAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCiAgICAgICAgaWYgJ3R5cGUnIGluIG90aGVyOgogICAgICAgICAgICBtb2RlX3R5cGUgPSByZV9tZShvdGhlciwndHlwZT1bXCciXSguKj8pW1wnIl0nKQogICAgICAgICAgICBpZiBtb2RlX3R5cGUgPT0gJ3l0LWRsJzoKICAgICAgICAgICAgICAgIHN0cmVhbV91cmwgPSBzdHJlYW1fdXJsICsiJm1vZGU9MTgiCiAgICAgICAgICAgIGVsaWYgbW9kZV90eXBlID09ICdyZWdleCc6CiAgICAgICAgICAgICAgICB1cmwgPSBzdHJlYW1fdXJsLnNwbGl0KCcmcmVnZXhzPScpCiAgICAgICAgICAgICAgICAjcHJpbnQgdXJsWzBdIGdldFNvdXAodXJsLGRhdGE9Tm9uZSkKICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KGdldFNvdXAoJycsZGF0YT11cmxbMV0pKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybFswXSwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLHJlZ2V4cyx0b3RhbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgYWRkTGluayhzdHJlYW1fdXJsLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWwpCgpkZWYgRmluZEZpcnN0UGF0dGVybih0ZXh0LHBhdHRlcm4pOgogICAgcmVzdWx0ID0gIiIKICAgIHRyeTogICAgCiAgICAgICAgbWF0Y2hlcyA9IHJlLmZpbmRhbGwocGF0dGVybix0ZXh0LCBmbGFncz1yZS5ET1RBTEwpCiAgICAgICAgcmVzdWx0ID0gbWF0Y2hlc1swXQogICAgZXhjZXB0OgogICAgICAgIHJlc3VsdCA9ICIiCgogICAgcmV0dXJuIHJlc3VsdAoJCmRlZiByZWdleF9nZXRfYWxsKHRleHQsIHN0YXJ0X3dpdGgsIGVuZF93aXRoKToKICAgIHIgPSByZS5maW5kYWxsKCIoP2kpKCIgKyBzdGFydF93aXRoICsgIltcU1xzXSs/IiArIGVuZF93aXRoICsgIikiLCB0ZXh0KQogICAgcmV0dXJuIHIJCQkJCgpkZWYgcmVnZXhfZnJvbV90byh0ZXh0LCBmcm9tX3N0cmluZywgdG9fc3RyaW5nLCBleGNsdWRpbmc9VHJ1ZSk6CiAgICBpZiBleGNsdWRpbmc6CgkgICB0cnk6IHIgPSByZS5zZWFyY2goIig/aSkiICsgZnJvbV9zdHJpbmcgKyAiKFtcU1xzXSs/KSIgKyB0b19zdHJpbmcsIHRleHQpLmdyb3VwKDEpCgkgICBleGNlcHQ6IHIgPSAnJwogICAgZWxzZToKICAgICAgIHRyeTogciA9IHJlLnNlYXJjaCgiKD9pKSgiICsgZnJvbV9zdHJpbmcgKyAiW1xTXHNdKz8iICsgdG9fc3RyaW5nICsgIikiLCB0ZXh0KS5ncm91cCgxKQogICAgICAgZXhjZXB0OiByID0gJycKICAgIHJldHVybiByCgpkZWYgZ2V0SXRlbXMoaXRlbXMsZmFuYXJ0KToKICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykKICAgICAgICBwcmludCAnU1RBUlQgR0VUIElURU1TICoqKioqJwogICAgICAgIGFkZG9uX2xvZygnVG90YWwgSXRlbXM6ICVzJyAldG90YWwpCiAgICAgICAgZm9yIGl0ZW0gaW4gaXRlbXM6CiAgICAgICAgICAgIGlzWE1MU291cmNlPUZhbHNlCiAgICAgICAgICAgIGlzSnNvbnJwYyA9IEZhbHNlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG5hbWUgPSBpdGVtKCd0aXRsZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgbmFtZSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIG5hbWUgPSAndW5rbm93bj8nCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnTmFtZSBFcnJvcicpCiAgICAgICAgICAgICAgICBuYW1lID0gJycKCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBpdGVtKCdlcGcnKToKICAgICAgICAgICAgICAgICAgICBpZiBpdGVtLmVwZ191cmw6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnR2V0IEVQRyBSZWdleCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ191cmwgPSBpdGVtLmVwZ191cmwuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ19yZWdleCA9IGl0ZW0uZXBnX3JlZ2V4LnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBlcGdfbmFtZSA9IGdldF9lcGcoZXBnX3VybCwgZXBnX3JlZ2V4KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBlcGdfbmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgKz0gJyAtICcgKyBlcGdfbmFtZQogICAgICAgICAgICAgICAgICAgIGVsaWYgaXRlbSgnZXBnJylbMF0uc3RyaW5nID4gMToKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSBnZXRlcGcoaXRlbSgnZXBnJylbMF0uc3RyaW5nKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnRVBHIEVycm9yJykKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdXJsID0gW10KICAgICAgICAgICAgICAgIGlmIGxlbihpdGVtKCdsaW5rJykpID4wOgojICAgICAgICAgICAgICAgICAgICBwcmludCAnaXRlbSBsaW5rJywgaXRlbSgnbGluaycpCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnbGluaycpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoaS5zdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdzcG9ydHNkZXZpbCcpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdzcG9ydHNkZXZpbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwb3J0c2RldmlsID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5TcG9ydHNEZXZpbC8/bW9kZT0xJmFtcDtpdGVtPWNhdGNoZXIlM2RzdHJlYW1zJTI2dXJsPScgK2kuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVyID0gaXRlbSgncmVmZXJlcicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVmZXJlcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3JlZmVyZXIgZm91bmQnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvcnRzZGV2aWwgPSBzcG9ydHNkZXZpbCArICclMjZyZWZlcmVyPScgK3JlZmVyZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoc3BvcnRzZGV2aWwpCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdwMnAnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgncDJwJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3NvcDovLycgaW4gaToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3AgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zLz91cmw9JytpLnN0cmluZyArJyZhbXA7bW9kZT0yJmFtcDsnICsgJ25hbWU9JytuYW1lIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoc29wKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcDJwPSdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvP3VybD0nK2kuc3RyaW5nICsnJmFtcDttb2RlPTEmYW1wOycgKyAnbmFtZT0nK25hbWUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChwMnApCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd2YXVnaG4nKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgndmF1Z2huJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmF1Z2huID0gJ3BsdWdpbjovL3BsdWdpbi5zdHJlYW0udmF1Z2hubGl2ZS50di8/bW9kZT1QbGF5TGl2ZVN0cmVhbSZhbXA7Y2hhbm5lbD0nK2kuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHZhdWdobikKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2lsaXZlJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2lsaXZlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90ICdodHRwJyBpbiBpLnN0cmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbGl2ZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8udGJoLmlsaXZlLz91cmw9aHR0cDovL3d3dy5zdHJlYW1saXZlLnRvL3ZpZXcvJytpLnN0cmluZysnJmFtcDtsaW5rPTk5JmFtcDttb2RlPWlMaXZlUGxheScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPScraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd5dC1kbCcpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd5dC1kbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl0ZGwgPSBpLnN0cmluZyArICcmbW9kZT0xOCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoeXRkbCkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3V0dWJlJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3V0dWJlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGkuc3RyaW5nKSA9PSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz92aWRlb19pZD0nKyBpLnN0cmluZyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgaS5zdHJpbmcuc3RhcnRzd2l0aCgnUEwnKSBhbmQgbm90ICcmb3JkZXI9JyBpbiBpLnN0cmluZyA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/Jm9yZGVyPWRlZmF1bHQmcGxheWxpc3RfaWQ9JyArIGkuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3BsYXlsaXN0X2lkPScgKyBpLnN0cmluZyAKICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHV0dWJlKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnaW1kYicpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdpbWRiJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnZ2VuZXNpc29ycHVsc2FyJykgPT0gJzAnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZGIgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmdlbmVzaXMvP2FjdGlvbj1wbGF5JmltZGI9JytpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWRiID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wdWxzYXIvbW92aWUvdHQnK2kuc3RyaW5nKycvcGxheScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoaW1kYikgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdmNG0nKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2Y0bScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJy5mNG0nIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAnLm0zdTgnIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpKycmYW1wO3N0cmVhbXR5cGU9SExTJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpKycmYW1wO3N0cmVhbXR5cGU9U0lNUExFJwogICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGY0bSkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2Z0dicpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdmdHYnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdHYgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLkYuVC5WLz9uYW1lPScrdXJsbGliLnF1b3RlKG5hbWUpICsnJnVybD0nICtpLnN0cmluZyArJyZtb2RlPTEyNSZjaF9mYW5hcnQ9bmEnCiAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoZnR2KSAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbGVuKHVybCkgPCAxOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnRXJyb3IgPGxpbms+IGVsZW1lbnQsIFBhc3Npbmc6JytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlzWE1MU291cmNlPUZhbHNlCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpc1hNTFNvdXJjZSA9IGl0ZW0oJ2V4dGVybmFsbGluaycpWzBdLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGlzWE1MU291cmNlOgogICAgICAgICAgICAgICAgZXh0X3VybD1baXNYTUxTb3VyY2VdCiAgICAgICAgICAgICAgICBpc1hNTFNvdXJjZT1UcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpc1hNTFNvdXJjZT1GYWxzZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpc0pzb25ycGMgPSBpdGVtKCdqc29ucnBjJylbMF0uc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICBpZiBpc0pzb25ycGM6CiAgICAgICAgICAgICAgICBleHRfdXJsPVtpc0pzb25ycGNdCiAgICAgICAgICAgICAgICBpc0pzb25ycGM9VHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaXNKc29ucnBjPUZhbHNlICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGl0ZW0oJ3RodW1ibmFpbCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgbm90IGl0ZW0oJ2ZhbmFydCcpOgogICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gdGh1bWJuYWlsCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGl0ZW0oJ2ZhbmFydCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRlc2MgPSBpdGVtKCdpbmZvJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGVzYyA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBnZW5yZSA9IGl0ZW0oJ2dlbnJlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGdlbnJlID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRhdGUgPSBpdGVtKCdkYXRlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGF0ZSA9ICcnCgogICAgICAgICAgICByZWdleHMgPSBOb25lCiAgICAgICAgICAgIGlmIGl0ZW0oJ3JlZ2V4Jyk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmVnX2l0ZW0gPSBpdGVtKCdyZWdleCcpCiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgocmVnX2l0ZW0pCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcGFzcyAgICAgICAgICAgIAogICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBsZW4odXJsKSA+IDE6CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYWx0ID0gMAogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0ID0gW10KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiB1cmw6CiAgICAgICAgICAgICAgICAgICAgCWlmIGFkZG9uLmdldFNldHRpbmcoJ2Fza19wbGF5bGlzdF9pdGVtcycpID09ICd0cnVlJzoKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlZ2V4czoKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJnJlZ2V4cz0nK3JlZ2V4cykKCSAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgIGFueSh4IGluIGkgZm9yIHggaW4gcmVzb2x2ZV91cmwpIGFuZCAgaS5zdGFydHN3aXRoKCdodHRwJyk6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYXBwZW5kKGkrJyZtb2RlPTE5JykgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSkKICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiB1cmw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWx0ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnQURETElOSyAxJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsoaSwnJXMpICVzJyAlKGFsdCwgbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluaygnJywgbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUscGxheWxpc3QscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpZiBpc1hNTFNvdXJjZToKICAgICAgICAgICAgICAgICAgICAJYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLGV4dF91cmxbMF0uZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWJuYWlsLGZhbmFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykKICAgICAgICAgICAgICAgICAgICBlbGlmIGlzSnNvbnJwYzoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLGV4dF91cmxbMF0sNTMsdGh1bWJuYWlsLGZhbmFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykKICAgICAgICAgICAgICAgICAgICBlbGlmIHVybFswXS5maW5kKCdzdWJsaW5rJykgPiAwOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksdXJsWzBdLDMwLHRodW1ibmFpbCxmYW5hcnQsJycsJycsJycsJycpCiAgICAgICAgICAgICAgICAgICAgICAgICNhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksdXJsWzBdLDMwLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLCdzdWJsaW5rJykJCQkJCiAgICAgICAgICAgICAgICAgICAgZWxzZTogCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQoKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3N1Y2Nlc3MnCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnVGhlcmUgd2FzIGEgcHJvYmxlbSBhZGRpbmcgaXRlbSAtICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQogICAgICAgIHByaW50ICdGSU5JU0ggR0VUIElURU1TICoqKioqJyAgICAgIAoKZGVmIHBhcnNlX3JlZ2V4KHJlZ19pdGVtKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB7fQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJlZ19pdGVtOgogICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ10gPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAjcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZSddID0gaSgnZXhwcmVzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmUnXSA9IGkoJ2V4cHJlcycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmUnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2V4cHJlJ109JycKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gUmVmZXJlciAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncGFnZSddID0gaSgncGFnZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3JlZmVyJ10gPSBpKCdyZWZlcmVyJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvbm5lY3Rpb24nXSA9IGkoJ2Nvbm5lY3Rpb24nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gY29ubmVjdGlvbiAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vdHBsYXlhYmxlJ10gPSBpKCdub3RwbGF5YWJsZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBub3RwbGF5YWJsZSAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydub3JlZGlyZWN0J10gPSBpKCdub3JlZGlyZWN0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vcmVkaXJlY3QgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ29yaWdpbiddID0gaSgnb3JpZ2luJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG9yaWdpbiAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaW5jbHVkZWhlYWRlcnMnXSA9IGkoJ2luY2x1ZGVoZWFkZXJzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIGluY2x1ZGVoZWFkZXJzIC0tIikgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LXJlcSddID0gaSgneC1yZXEnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8geC1yZXEgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtZm9yd2FyZCddID0gaSgneC1mb3J3YXJkJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHgtZm9yd2FyZCAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FnZW50J10gPSBpKCdhZ2VudCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBVc2VyIEFnZW50IC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwb3N0J10gPSBpKCdwb3N0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHBvc3QiKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3Jhd3Bvc3QnXSA9IGkoJ3Jhd3Bvc3QnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgcmF3cG9zdCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaHRtbHVuZXNjYXBlJ10gPSBpKCdodG1sdW5lc2NhcGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgaHRtbHVuZXNjYXBlIikKCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3JlYWRjb29raWVvbmx5J10gPSBpKCdyZWFkY29va2llb25seScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSByZWFkQ29va2llT25seSIpCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29va2llamFyJ10gPSBpKCdjb29raWVqYXInKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29va2llamFyJ109JycKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgY29va2llSmFyIikJCQkJCQkJCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnc2V0Y29va2llJ10gPSBpKCdzZXRjb29raWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgc2V0Y29va2llIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydhcHBlbmRjb29raWUnXSA9IGkoJ2FwcGVuZGNvb2tpZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBhcHBlbmRjb29raWUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaWdub3JlY2FjaGUnXSA9IGkoJ2lnbm9yZWNhY2hlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikKICAgICAgICAgICAgICAgICAgICAgICAgI3RyeToKICAgICAgICAgICAgICAgICAgICAgICAgIyAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2lnbm9yZWNhY2hlJ10gPSBpKCdpZ25vcmVjYWNoZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAjZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAjICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikJCQkKCiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gdXJsbGliLnF1b3RlKHJlcHIocmVnZXhzKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZXhzCiAgICAgICAgICAgICAgICAgICAgI3ByaW50IHJlZ2V4cwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUKICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ3JlZ2V4IEVycm9yOiAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKI2NvcGllcyBmcm9tIGxhbWRhJ3MgaW1wbGVtZW50YXRpb24KZGVmIGdldF91c3RyZWFtKHVybCk6CiAgICB0cnk6CiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMSwgNTEpOgogICAgICAgICAgICByZXN1bHQgPSBnZXRVcmwodXJsKQogICAgICAgICAgICBpZiAiRVhULVgtU1RSRUFNLUlORiIgaW4gcmVzdWx0OiByZXR1cm4gdXJsCiAgICAgICAgICAgIGlmIG5vdCAiRVhUTTNVIiBpbiByZXN1bHQ6IHJldHVybgogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMDApCiAgICAgICAgcmV0dXJuCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuCiAgICAgICAgCiAKZGVmIGdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsLGNvb2tpZUphcj1Ob25lLGZvckNvb2tpZUphck9ubHk9RmFsc2UscmVjdXJzaXZlQ2FsbD1GYWxzZSxjYWNoZWRQYWdlcz17fSwgcmF3UG9zdD1GYWxzZSwgY29va2llX2phcl9maWxlPU5vbmUpOiMwLDEsMiA9IFVSTCwgcmVnZXhPbmx5LCBDb29raWVKYXJPbmx5CiAgICAgICAgaWYgbm90IHJlY3Vyc2l2ZUNhbGw6CiAgICAgICAgICAgIHJlZ2V4cyA9IGV2YWwodXJsbGliLnVucXVvdGUocmVnZXhzKSkKICAgICAgICAjY2FjaGVkUGFnZXMgPSB7fQogICAgICAgICNwcmludCAndXJsJyx1cmwKICAgICAgICBkb1JlZ2V4cyA9IHJlLmNvbXBpbGUoJ1wkZG9yZWdleFxbKFteXF1dKilcXScpLmZpbmRhbGwodXJsKQogICAgICAgICNwcmludCAnZG9SZWdleHMnLGRvUmVnZXhzLHJlZ2V4cwogICAgICAgIHNldHJlc29sdmVkPVRydWUKICAgICAgICAgICAgICAKIAoKCiAgICAgICAgZm9yIGsgaW4gZG9SZWdleHM6CiAgICAgICAgICAgIGlmIGsgaW4gcmVnZXhzOgogICAgICAgICAgICAgICAgI3ByaW50ICdwcm9jZXNzaW5nICcgLGsKICAgICAgICAgICAgICAgIG0gPSByZWdleHNba10KICAgICAgICAgICAgICAgICNwcmludCBtCiAgICAgICAgICAgICAgICBjb29raWVKYXJQYXJhbT1GYWxzZQoKCiAgICAgICAgICAgICAgICBpZiAgJ2Nvb2tpZWphcicgaW4gbTogIyBzbyBlaXRoZXIgY3JlYXRlIG9yIHJldXNlIGV4aXN0aW5nIGphcgogICAgICAgICAgICAgICAgICAgICNwcmludCAnY29va2llamFyIGV4aXN0cycsbVsnY29va2llamFyJ10KICAgICAgICAgICAgICAgICAgICBjb29raWVKYXJQYXJhbT1tWydjb29raWVqYXInXQogICAgICAgICAgICAgICAgICAgIGlmICAnJGRvcmVnZXgnIGluIGNvb2tpZUphclBhcmFtOgogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXI9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydjb29raWVqYXInXSxjb29raWVKYXIsVHJ1ZSwgVHJ1ZSxjYWNoZWRQYWdlcykKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09VHJ1ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUKICAgICAgICAgICAgICAgICNwcmludCAnbVtjb29raWVqYXJdJyxtWydjb29raWVqYXInXSxjb29raWVKYXIKICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphclBhcmFtOgogICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphcj09Tm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjcmVhdGUgY29va2llIGphcicKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2phcl9maWxlPU5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ29wZW5bJyBpbiBtWydjb29raWVqYXInXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9qYXJfZmlsZT1tWydjb29raWVqYXInXS5zcGxpdCgnb3BlblsnKVsxXS5zcGxpdCgnXScpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyPWdldENvb2tpZUphcihjb29raWVfamFyX2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZV9qYXJfZmlsZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDb29raWVKYXIoY29va2llSmFyLGNvb2tpZV9qYXJfZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgI2ltcG9ydCBjb29raWVsaWIKICAgICAgICAgICAgICAgICAgICAgICAgI2Nvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZUphciBuZXcnLGNvb2tpZUphcgogICAgICAgICAgICAgICAgICAgIGVsaWYgJ3NhdmVbJyBpbiBtWydjb29raWVqYXInXToKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2phcl9maWxlPW1bJ2Nvb2tpZWphciddLnNwbGl0KCdzYXZlWycpWzFdLnNwbGl0KCddJylbMF0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxjb29raWVfamFyX2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdjb21wbGV0ZV9wYXRoJyxjb21wbGV0ZV9wYXRoCiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDb29raWVKYXIoY29va2llSmFyLGNvb2tpZV9qYXJfZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAKICAgICAgICAgICAgICAgIGlmICBtWydwYWdlJ10gYW5kICckZG9yZWdleCcgaW4gbVsncGFnZSddOgogICAgICAgICAgICAgICAgICAgIG1bJ3BhZ2UnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3BhZ2UnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQoKICAgICAgICAgICAgICAgIGlmICdzZXRjb29raWUnIGluIG0gYW5kIG1bJ3NldGNvb2tpZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3NldGNvb2tpZSddOgogICAgICAgICAgICAgICAgICAgIG1bJ3NldGNvb2tpZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnc2V0Y29va2llJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykKICAgICAgICAgICAgICAgIGlmICdhcHBlbmRjb29raWUnIGluIG0gYW5kIG1bJ2FwcGVuZGNvb2tpZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ2FwcGVuZGNvb2tpZSddOgogICAgICAgICAgICAgICAgICAgIG1bJ2FwcGVuZGNvb2tpZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnYXBwZW5kY29va2llJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykKCiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAgJ3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Bvc3QnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3Bvc3QnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgICAgIHByaW50ICdwb3N0IGlzIG5vdycsbVsncG9zdCddCgogICAgICAgICAgICAgICAgaWYgICdyYXdwb3N0JyBpbiBtIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3Jhd3Bvc3QnXToKICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydyYXdwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcyxyYXdQb3N0PVRydWUpCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyYXdwb3N0IGlzIG5vdycsbVsncmF3cG9zdCddCiAgCiAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbSBhbmQgJyRlcG9jdGltZSQnIGluIG1bJ3Jhd3Bvc3QnXToKICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109bVsncmF3cG9zdCddLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpCiAgCiAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbSBhbmQgJyRlcG9jdGltZTIkJyBpbiBtWydyYXdwb3N0J106CiAgICAgICAgICAgICAgICAgICAgbVsncmF3cG9zdCddPW1bJ3Jhd3Bvc3QnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpCgogIAogICAgICAgICAgICAgICAgbGluaz0nJwogICAgICAgICAgICAgICAgaWYgbVsncGFnZSddIGFuZCBtWydwYWdlJ10gaW4gY2FjaGVkUGFnZXMgYW5kIG5vdCAnaWdub3JlY2FjaGUnIGluIG0gYW5kIGZvckNvb2tpZUphck9ubHk9PUZhbHNlIDoKICAgICAgICAgICAgICAgICAgICBsaW5rID0gY2FjaGVkUGFnZXNbbVsncGFnZSddXQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10gYW5kICBub3QgbVsncGFnZSddPT0nJyBhbmQgIG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiBtWydwYWdlJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109bVsncGFnZSddLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZXBvY3RpbWUyJCcgaW4gbVsncGFnZSddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpCgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ0luZ29yaW5nIENhY2hlJyxtWydwYWdlJ10KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZV9zcGxpdD1tWydwYWdlJ10uc3BsaXQoJ3wnKQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlVXJsPXBhZ2Vfc3BsaXRbMF0KICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9Tm9uZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFnZV9zcGxpdCk+MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcl9pbl9wYWdlPXBhZ2Vfc3BsaXRbMV0KICAgICAgICAgICAgICAgICAgICAgICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHBhZ2VVcmwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAncmVmZXInIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignUmVmZXJlcicsIG1bJ3JlZmVyJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhZ2VudCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLWFnZW50JywgbVsnYWdlbnQnXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3gtcmVxJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCBtWyd4LXJlcSddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1mb3J3YXJkJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtRm9yd2FyZGVkLUZvcicsIG1bJ3gtZm9yd2FyZCddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnc2V0Y29va2llJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2FkZGluZyBjb29raWUnLG1bJ3NldGNvb2tpZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignQ29va2llJywgbVsnc2V0Y29va2llJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhcHBlbmRjb29raWUnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnYXBwZW5kaW5nIGNvb2tpZSB0byBjb29raWVqYXInLG1bJ2FwcGVuZGNvb2tpZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzdG9BcGVuZD1tWydhcHBlbmRjb29raWUnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llc3RvQXBlbmQ9Y29va2llc3RvQXBlbmQuc3BsaXQoJzsnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGggaW4gY29va2llc3RvQXBlbmQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbix2PWguc3BsaXQoJz0nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcsbj0gbi5zcGxpdCgnOicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2sgPSBjb29raWVsaWIuQ29va2llKHZlcnNpb249MCwgbmFtZT1uLCB2YWx1ZT12LCBwb3J0PU5vbmUsIHBvcnRfc3BlY2lmaWVkPUZhbHNlLCBkb21haW49dywgZG9tYWluX3NwZWNpZmllZD1GYWxzZSwgZG9tYWluX2luaXRpYWxfZG90PUZhbHNlLCBwYXRoPScvJywgcGF0aF9zcGVjaWZpZWQ9VHJ1ZSwgc2VjdXJlPUZhbHNlLCBleHBpcmVzPU5vbmUsIGRpc2NhcmQ9VHJ1ZSwgY29tbWVudD1Ob25lLCBjb21tZW50X3VybD1Ob25lLCByZXN0PXsnSHR0cE9ubHknOiBOb25lfSwgcmZjMjEwOT1GYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXIuc2V0X2Nvb2tpZShjaykKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdvcmlnaW4nIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignT3JpZ2luJywgbVsnb3JpZ2luJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhlYWRlcl9pbl9wYWdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9aGVhZGVyX2luX3BhZ2Uuc3BsaXQoJyYnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGggaW4gaGVhZGVyX2luX3BhZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbix2PWguc3BsaXQoJz0nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKG4sdikKCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgY29va2llSmFyPT1Ob25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVKYXJWYWwnLGNvb2tpZUphcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnbm9yZWRpcmVjdCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoTm9SZWRpcmVjdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcjIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdjb25uZWN0aW9uJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uY29ubmVjdGlvbi8vLy8vLy4nLG1bJ2Nvbm5lY3Rpb24nXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSBrZWVwYWxpdmUgaW1wb3J0IEhUVFBIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZWVwYWxpdmVfaGFuZGxlciA9IEhUVFBIYW5kbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGtlZXBhbGl2ZV9oYW5kbGVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdhZnRlciBjb29raWUgamFyJwogICAgICAgICAgICAgICAgICAgICAgICBwb3N0PU5vbmUKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdwb3N0JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdERhdGE9bVsncG9zdCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1SZWNhcHRjaGEnIGluIHBvc3REYXRhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjYXB0Y2hhX2NoYWxsZW5nZSxjYXRwY2hhX3dvcmQpPXByb2Nlc3NSZWNhcHRjaGEobVsncGFnZSddKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNhcHRjaGFfY2hhbGxlbmdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YSs9J3JlY2FwdGNoYV9jaGFsbGVuZ2VfZmllbGQ6JytjYXB0Y2hhX2NoYWxsZW5nZSsnLHJlY2FwdGNoYV9yZXNwb25zZV9maWVsZDonK2NhdHBjaGFfd29yZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BsaXRwb3N0PXBvc3REYXRhLnNwbGl0KCcsJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0PXt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcCBpbiBzcGxpdHBvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbj1wLnNwbGl0KCc6JylbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdj1wLnNwbGl0KCc6JylbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdFtuXT12CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0ID0gdXJsbGliLnVybGVuY29kZShwb3N0KQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0PW1bJ3Jhd3Bvc3QnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjYXB0Y2hhX2NoYWxsZW5nZSxjYXRwY2hhX3dvcmQpPXByb2Nlc3NSZWNhcHRjaGEobVsncGFnZSddKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNhcHRjaGFfY2hhbGxlbmdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QrPScmcmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZD0nK2NhcHRjaGFfY2hhbGxlbmdlKycmcmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkPScrY2F0cGNoYV93b3JkCgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSxwb3N0KQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQoKICAgICAgICAgICAgICAgICAgICAgICAgbGluayA9IHJlc3BvbnNlLnJlYWQoKQogICAgICAgICAgICAgICAgICAgICAgICBsaW5rPWphdmFzY3JpcHRVbkVzY2FwZShsaW5rKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbGluayBUaGlzIGp1c3QgcHJpbnQgd2hvbGUgd2VicGFnZSBpbiBMT0cKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2luY2x1ZGVoZWFkZXJzJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluays9c3RyKHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdTZXQtQ29va2llJykpCgogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZFBhZ2VzW21bJ3BhZ2UnXV0gPSBsaW5rCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBsaW5rCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnc3RvcmUgbGluayBmb3InLG1bJ3BhZ2UnXSxmb3JDb29raWVKYXJPbmx5CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBmb3JDb29raWVKYXJPbmx5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZwogICAgICAgICAgICAgICAgICAgIGVsaWYgbVsncGFnZSddIGFuZCAgbm90IG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCckcHlGdW5jdGlvbjonKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsncGFnZSddLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSwnJyxjb29raWVKYXIgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZm9yQ29va2llSmFyT25seToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29va2llSmFyIyBkbyBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPXZhbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1tWydwYWdlJ10KICAgICAgICAgICAgICAgIGlmICckcHlGdW5jdGlvbjpwbGF5bWVkaWEoJyBpbiBtWydleHByZSddIG9yICdBY3RpdmF0ZVdpbmRvdycgIGluIG1bJ2V4cHJlJ10gICBvciAgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpOgogICAgICAgICAgICAgICAgICAgIHNldHJlc29sdmVkPUZhbHNlCiAgICAgICAgICAgICAgICBpZiAgJyRkb3JlZ2V4JyBpbiBtWydleHByZSddOgogICAgICAgICAgICAgICAgICAgIG1bJ2V4cHJlJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydleHByZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBtWydleHByZSddPT0nJzoKICAgICAgICAgICAgICAgICAgICBwcmludCAnZG9pbmcgaXQgJyxtWydleHByZSddCiAgICAgICAgICAgICAgICAgICAgaWYgJyRMaXZlU3RyZWFtQ2FwdGNoYScgaW4gbVsnZXhwcmUnXToKICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWFza0NhcHRjaGEobSxsaW5rLGNvb2tpZUphcikKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICd1cmwgYW5kIHZhbCcsdXJsLHZhbAogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkKICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ2V4cHJlJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnZXhwZWVlZWVlZWVlZWVlZWVlZWVlZScsbVsnZXhwcmUnXQogICAgICAgICAgICAgICAgICAgICAgICB2YWw9ZG9FdmFsKG1bJ2V4cHJlJ10uc3BsaXQoJyRweUZ1bmN0aW9uOicpWzFdLGxpbmssY29va2llSmFyICkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ0FjdGl2YXRlV2luZG93JyBpbiBtWydleHByZSddOiByZXR1cm4gCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdzdGlsbCBocmUnCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICd1cmwgayB2YWwnLHVybCxrLHZhbAoKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCB2YWwpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGxpbms9PScnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnID0gcmUuY29tcGlsZShtWydleHByZSddKS5zZWFyY2gobGluaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD0nJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZWcuZ3JvdXAoMSkuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1tWydleHByZSddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJhd1Bvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAncmF3cG9zdCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD11cmxsaWIucXVvdGVfcGx1cyh2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdodG1sdW5lc2NhcGUnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjdmFsPXVybGxpYi51bnF1b3RlX3BsdXModmFsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0IEhUTUxQYXJzZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1IVE1MUGFyc2VyLkhUTUxQYXJzZXIoKS51bmVzY2FwZSh2YWwpICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQogICAgICAgICAgICAgICAgICAgICAgICAjcmV0dXJuIHZhbAogICAgICAgICAgICAgICAgZWxzZTogICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwnJykKICAgICAgICBpZiAnJGVwb2N0aW1lJCcgaW4gdXJsOgogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpCiAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiB1cmw6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJGVwb2N0aW1lMiQnLGdldEVwb2NUaW1lMigpKQoKICAgICAgICBpZiAnJEdVSUQkJyBpbiB1cmw6CiAgICAgICAgICAgIGltcG9ydCB1dWlkCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJEdVSUQkJyxzdHIodXVpZC51dWlkMSgpKS51cHBlcigpKQogICAgICAgIGlmICckZ2V0X2Nvb2tpZXMkJyBpbiB1cmw6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJGdldF9jb29raWVzJCcsZ2V0Q29va2llc1N0cmluZyhjb29raWVKYXIpKSAgIAoKICAgICAgICBpZiByZWN1cnNpdmVDYWxsOiByZXR1cm4gdXJsCiAgICAgICAgcHJpbnQgJ2ZpbmFsIHVybCcsdXJsCiAgICAgICAgaWYgdXJsPT0iIjogCiAgICAgICAgCXJldHVybgogICAgICAgIGVsc2U6CiAgICAgICAgCXJldHVybiB1cmwsc2V0cmVzb2x2ZWQKCiAgICAgICAgICAgIAogICAgICAgIApkZWYgZ2V0bWQ1KHQpOgogICAgaW1wb3J0IGhhc2hsaWIKICAgIGg9aGFzaGxpYi5tZDUoKQogICAgaC51cGRhdGUodCkKICAgIHJldHVybiBoLmhleGRpZ2VzdCgpCgpkZWYgZGVjcnlwdF92YXVnaG5saXZlKGVuY3J5cHRlZCk6CiAgICByZXRWYWw9IiIKICAgIGZvciB2YWwgaW4gZW5jcnlwdGVkLnNwbGl0KCc6Jyk6CiAgICAgICAgcmV0VmFsKz1jaHIoaW50KHZhbC5yZXBsYWNlKCIwbTAiLCIiKSkvODQvNSkKICAgIHJldHVybiByZXRWYWwKCmRlZiBwbGF5bWVkaWEobWVkaWFfdXJsKToKICAgIHRyeToKICAgICAgICBpbXBvcnQgIEN1c3RvbVBsYXllcgogICAgICAgIHBsYXllciA9IEN1c3RvbVBsYXllci5NeVhCTUNQbGF5ZXIoKQogICAgICAgIGxpc3RpdGVtID0geGJtY2d1aS5MaXN0SXRlbSggbGFiZWwgPSBzdHIobmFtZSksIGljb25JbWFnZSA9ICJEZWZhdWx0VmlkZW8ucG5nIiwgdGh1bWJuYWlsSW1hZ2UgPSB4Ym1jLmdldEluZm9JbWFnZSggIkxpc3RJdGVtLlRodW1iIiApLCBwYXRoPW1lZGlhX3VybCApCiAgICAgICAgcGxheWVyLnBsYXkoIG1lZGlhX3VybCxsaXN0aXRlbSkKICAgICAgICB4Ym1jLnNsZWVwKDEwMDApCiAgICAgICAgd2hpbGUgcGxheWVyLmlzX2FjdGl2ZToKICAgICAgICAgICAgeGJtYy5zbGVlcCgyMDApCiAgICBleGNlcHQ6CiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICByZXR1cm4gJycKICAgIAogICAgICAgIApkZWYgZ2V0X3Nhd19ydG1wKHBhZ2VfdmFsdWUsIHJlZmVyZXI9Tm9uZSk6CiAgICBpZiByZWZlcmVyOgogICAgICAgIHJlZmVyZXI9WygnUmVmZXJlcicscmVmZXJlcildCiAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICBwYWdlX3VybD1wYWdlX3ZhbHVlCiAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUsaGVhZGVycz1yZWZlcmVyKQoKICAgIHN0cl9wYXR0ZXJuPSIoZXZhbFwoZnVuY3Rpb25cKHAsYSxjLGssZSwoPzpyfGQpLiopIgoKICAgIHJlZ19yZXM9cmUuY29tcGlsZShzdHJfcGF0dGVybikuZmluZGFsbChwYWdlX3ZhbHVlKQogICAgcj0iIgogICAgaWYgcmVnX3JlcyBhbmQgbGVuKHJlZ19yZXMpPjA6CiAgICAgICAgZm9yIHYgaW4gcmVnX3JlczoKICAgICAgICAgICAgcjE9Z2V0X3VucGFja2VkKHYpCiAgICAgICAgICAgIHIyPXJlX21lKHIxLCdcJyguKj8pXCcnKQogICAgICAgICAgICBpZiAndW5lc2NhcGUnIGluIHIxOgogICAgICAgICAgICAgICAgcjE9dXJsbGliLnVucXVvdGUocjIpCiAgICAgICAgICAgIHIrPXIxKydcbicKICAgICAgICBwcmludCAnZmluYWwgdmFsdWUgaXMgJyxyCiAgICAgICAgCiAgICAgICAgcGFnZV91cmw9cmVfbWUociwnc3JjPSIoLio/KSInKQogICAgICAgIAogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3VybCxoZWFkZXJzPXJlZmVyZXIpCgogICAgI3ByaW50IHBhZ2VfdmFsdWUKCiAgICBydG1wPXJlX21lKHBhZ2VfdmFsdWUsJ3N0cmVhbWVyXCcuKj9cJyguKj8pXCdcKScpCiAgICBwbGF5cGF0aD1yZV9tZShwYWdlX3ZhbHVlLCdmaWxlXCcsXHNcJyguKj8pXCcnKQoKICAgIAogICAgcmV0dXJuIHJ0bXArJyBwbGF5cGF0aD0nK3BsYXlwYXRoICsnIHBhZ2VVcmw9JytwYWdlX3VybAogICAgCmRlZiBnZXRfbGV0b25fcnRtcChwYWdlX3ZhbHVlLCByZWZlcmVyPU5vbmUpOgogICAgaWYgcmVmZXJlcjoKICAgICAgICByZWZlcmVyPVsoJ1JlZmVyZXInLHJlZmVyZXIpXQogICAgaWYgcGFnZV92YWx1ZS5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUsaGVhZGVycz1yZWZlcmVyKQogICAgc3RyX3BhdHRlcm49InZhciBhID0gKC4qPyk7XHMqdmFyIGIgPSAoLio/KTtccyp2YXIgYyA9ICguKj8pO1xzKnZhciBkID0gKC4qPyk7XHMqdmFyIGYgPSAoLio/KTtccyp2YXIgdl9wYXJ0ID0gJyguKj8pJzsiCiAgICByZWdfcmVzPXJlLmNvbXBpbGUoc3RyX3BhdHRlcm4pLmZpbmRhbGwocGFnZV92YWx1ZSlbMF0gCgogICAgYSxiLGMsZCxmLHY9KHJlZ19yZXMpCiAgICBmPWludChmKQogICAgYT1pbnQoYSkvZgogICAgYj1pbnQoYikvZgogICAgYz1pbnQoYykvZgogICAgZD1pbnQoZCkvZgoKICAgIHJldD0gJ3J0bXA6Ly8nICsgc3RyKGEpICsgJy4nICsgc3RyKGIpICsgJy4nICsgc3RyKGMpICsgJy4nICsgc3RyKGQpICsgdjsKICAgIHJldHVybiByZXQKCmRlZiBjcmVhdGVNM3VGb3JEYXNoKHVybCx1c2VyYWdlbnQ9Tm9uZSk6CiAgICBzdHI9JyNFWFRNM1UnCiAgICBzdHIrPSdcbiNFWFQtWC1TVFJFQU0tSU5GOlBST0dSQU0tSUQ9MSxCQU5EV0lEVEg9MzYxODE2JwogICAgc3RyKz0nXG4nK3VybCsnJmJ5dGVzPTAtMjAwMDAwJyMrJ3xVc2VyLUFnZW50PScrdXNlcmFnZW50CiAgICBzb3VyY2VfZmlsZSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAndGVzdGZpbGUubTN1JykKICAgIHN0cis9J1xuJwogICAgU2F2ZVRvRmlsZShzb3VyY2VfZmlsZSxzdHIpCiAgICAjcmV0dXJuICdDOi9Vc2Vycy9zaGFuaS9Eb3dubG9hZHMvdGVzdC5tM3U4JwogICAgcmV0dXJuIHNvdXJjZV9maWxlCgpkZWYgU2F2ZVRvRmlsZShmaWxlX25hbWUscGFnZV9kYXRhLGFwcGVuZD1GYWxzZSk6CiAgICBpZiBhcHBlbmQ6CiAgICAgICAgZiA9IG9wZW4oZmlsZV9uYW1lLCAnYScpCiAgICAgICAgZi53cml0ZShwYWdlX2RhdGEpCiAgICAgICAgZi5jbG9zZSgpICAgICAgICAKICAgIGVsc2U6CiAgICAgICAgZj1vcGVuKGZpbGVfbmFtZSwnd2InKQogICAgICAgIGYud3JpdGUocGFnZV9kYXRhKQogICAgICAgIGYuY2xvc2UoKQogICAgICAgIHJldHVybiAnJwogICAgCmRlZiBMb2FkRmlsZShmaWxlX25hbWUpOgoJZj1vcGVuKGZpbGVfbmFtZSwncmInKQoJZD1mLnJlYWQoKQoJZi5jbG9zZSgpCglyZXR1cm4gZAogICAgCmRlZiBnZXRfcGFja2VkX2lwaG9uZXR2X3VybChwYWdlX2RhdGEpOgoJaW1wb3J0IHJlLGJhc2U2NCx1cmxsaWI7IAoJcz1wYWdlX2RhdGEKCXdoaWxlICdnZWgoJyBpbiBzOgoJCWlmIHMuc3RhcnRzd2l0aCgnbG9sKCcpOiBzPXNbNTotMV0gICAgCiMJCXByaW50ICdzIGlzICcscwoJCXM9cmUuY29tcGlsZSgnIiguKj8pIicpLmZpbmRhbGwocylbMF07IAoJCXM9ICBiYXNlNjQuYjY0ZGVjb2RlKHMpOyAKCQlzPXVybGxpYi51bnF1b3RlKHMpOyAKCXByaW50IHMKCXJldHVybiBzCgpkZWYgZ2V0X2ZlcnJhcmlfdXJsKHBhZ2VfZGF0YSk6CiAgICBwcmludCAnZ2V0X2RhZ191cmwyJyxwYWdlX2RhdGEKICAgIHBhZ2VfZGF0YTI9Z2V0VXJsKHBhZ2VfZGF0YSk7CiAgICBwYXR0PScoaHR0cC4qKScKICAgIGltcG9ydCB1dWlkCiAgICBwbGF5YmFjaz1zdHIodXVpZC51dWlkMSgpKS51cHBlcigpCiAgICBsaW5rcz1yZS5jb21waWxlKHBhdHQpLmZpbmRhbGwocGFnZV9kYXRhMikKICAgIGhlYWRlcnM9WygnWC1QbGF5YmFjay1TZXNzaW9uLUlkJyxwbGF5YmFjayldCiAgICBmb3IgbCBpbiBsaW5rczoKICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBwYWdlX2RhdGF0ZW1wPWdldFVybChsLGhlYWRlcnM9aGVhZGVycyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAKICAgIHJldHVybiBwYWdlX2RhdGErJ3wmWC1QbGF5YmFjay1TZXNzaW9uLUlkPScrcGxheWJhY2sKCiAgICAKZGVmIGdldF9kYWdfdXJsKHBhZ2VfZGF0YSk6CiAgICBwcmludCAnZ2V0X2RhZ191cmwnLHBhZ2VfZGF0YQogICAgaWYgcGFnZV9kYXRhLnN0YXJ0c3dpdGgoJ2h0dHA6Ly9kYWcudG90YWwtc3RyZWFtLm5ldCcpOgogICAgICAgIGhlYWRlcnM9WygnVXNlci1BZ2VudCcsJ1ZlcmlzbW8tQmxhY2tVSV8oMi40LjcuNS44LjAuMzQpJyldCiAgICAgICAgcGFnZV9kYXRhPWdldFVybChwYWdlX2RhdGEsaGVhZGVycz1oZWFkZXJzKTsKCiAgICBpZiAnMTI3LjAuMC4xJyBpbiBwYWdlX2RhdGE6CiAgICAgICAgcmV0dXJuIHJldmlzdF9kYWcocGFnZV9kYXRhKQogICAgZWxpZiByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgIT0gJyc6CiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnP3dtc0F1dGhTaWduPScgKyByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgKyAnPT0vbXA0OicgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbXiZdKykmJykKICAgIGVsc2U6CiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnaHJlZj0iKFteIl0rKSJbXiJdKyQnKQogICAgICAgIGlmIGxlbihmaW5hbF91cmwpPT0wOgogICAgICAgICAgICBmaW5hbF91cmw9cGFnZV9kYXRhCiAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgnICcsICclMjAnKQogICAgcmV0dXJuIGZpbmFsX3VybAoKZGVmIHJlX21lKGRhdGEsIHJlX3BhdHRlbik6CiAgICBtYXRjaCA9ICcnCiAgICBtID0gcmUuc2VhcmNoKHJlX3BhdHRlbiwgZGF0YSkKICAgIGlmIG0gIT0gTm9uZToKICAgICAgICBtYXRjaCA9IG0uZ3JvdXAoMSkKICAgIGVsc2U6CiAgICAgICAgbWF0Y2ggPSAnJwogICAgcmV0dXJuIG1hdGNoCgpkZWYgcmV2aXN0X2RhZyhwYWdlX2RhdGEpOgogICAgZmluYWxfdXJsID0gJycKICAgIGlmICcxMjcuMC4wLjEnIGluIHBhZ2VfZGF0YToKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICcmdmVyX3Q9KFteJl0rKSYnKSArICcgbGl2ZT10cnVlIHRpbWVvdXQ9MTUgcGxheXBhdGg9JyArIHJlX21lKHBhZ2VfZGF0YSwgJ1xcP3k9KFthLXpBLVowLTktX1xcLkBdKyknKQogICAgICAgIAogICAgaWYgcmVfbWUocGFnZV9kYXRhLCAndG9rZW49KFteJl0rKSYnKSAhPSAnJzoKICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwgKyAnP3Rva2VuPScgKyByZV9tZShwYWdlX2RhdGEsICd0b2tlbj0oW14mXSspJicpCiAgICBlbGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSAhPSAnJzoKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICcmdmVyX3Q9KFteJl0rKSYnKSArICc/d21zQXV0aFNpZ249JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSArICc9PS9tcDQ6JyArIHJlX21lKHBhZ2VfZGF0YSwgJ1xcP3k9KFteJl0rKSYnKQogICAgZWxzZToKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICdIUkVGPSIoW14iXSspIicpCgogICAgaWYgJ2RhZzEuYXN4JyBpbiBmaW5hbF91cmw6CiAgICAgICAgcmV0dXJuIGdldF9kYWdfdXJsKGZpbmFsX3VybCkKCiAgICBpZiAnZGV2aW5saXZlZnMuZnBsaXZlLm5ldCcgbm90IGluIGZpbmFsX3VybDoKICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgnZGV2aW5saXZlJywgJ2ZsaXZlJykKICAgIGlmICdwZXJtbGl2ZWZzLmZwbGl2ZS5uZXQnIG5vdCBpbiBmaW5hbF91cmw6CiAgICAgICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJ3Blcm1saXZlJywgJ2ZsaXZlJykKICAgIHJldHVybiBmaW5hbF91cmwKCgpkZWYgZ2V0X3Vud2lzZSggc3RyX2V2YWwpOgogICAgcGFnZV92YWx1ZT0iIgogICAgdHJ5OiAgICAgICAgCiAgICAgICAgc3M9IncsaSxzLGU9KCIrc3RyX2V2YWwrJyknIAogICAgICAgIGV4ZWMgKHNzKQogICAgICAgIHBhZ2VfdmFsdWU9dW53aXNlX2Z1bmModyxpLHMsZSkKICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpCiAgICAjcHJpbnQgJ3VucGFja2VkJyxwYWdlX3ZhbHVlCiAgICByZXR1cm4gcGFnZV92YWx1ZQogICAgCmRlZiB1bndpc2VfZnVuYyggdywgaSwgcywgZSk6CiAgICBsSWxsID0gMDsKICAgIGxsMUkgPSAwOwogICAgSWwxbCA9IDA7CiAgICBsbDFsID0gW107CiAgICBsMWxJID0gW107CiAgICB3aGlsZSBUcnVlOgogICAgICAgIGlmIChsSWxsIDwgNSk6CiAgICAgICAgICAgIGwxbEkuYXBwZW5kKHdbbElsbF0pCiAgICAgICAgZWxpZiAobElsbCA8IGxlbih3KSk6CiAgICAgICAgICAgIGxsMWwuYXBwZW5kKHdbbElsbF0pOwogICAgICAgIGxJbGwrPTE7CiAgICAgICAgaWYgKGxsMUkgPCA1KToKICAgICAgICAgICAgbDFsSS5hcHBlbmQoaVtsbDFJXSkKICAgICAgICBlbGlmIChsbDFJIDwgbGVuKGkpKToKICAgICAgICAgICAgbGwxbC5hcHBlbmQoaVtsbDFJXSkKICAgICAgICBsbDFJKz0xOwogICAgICAgIGlmIChJbDFsIDwgNSk6CiAgICAgICAgICAgIGwxbEkuYXBwZW5kKHNbSWwxbF0pCiAgICAgICAgZWxpZiAoSWwxbCA8IGxlbihzKSk6CiAgICAgICAgICAgIGxsMWwuYXBwZW5kKHNbSWwxbF0pOwogICAgICAgIElsMWwrPTE7CiAgICAgICAgaWYgKGxlbih3KSArIGxlbihpKSArIGxlbihzKSArIGxlbihlKSA9PSBsZW4obGwxbCkgKyBsZW4obDFsSSkgKyBsZW4oZSkpOgogICAgICAgICAgICBicmVhazsKICAgICAgICAKICAgIGxJMWwgPSAnJy5qb2luKGxsMWwpIy5qb2luKCcnKTsKICAgIEkxbEkgPSAnJy5qb2luKGwxbEkpIy5qb2luKCcnKTsKICAgIGxsMUkgPSAwOwogICAgbDFsbCA9IFtdOwogICAgZm9yIGxJbGwgaW4gcmFuZ2UoMCxsZW4obGwxbCksMik6CiAgICAgICAgI3ByaW50ICdhcnJheSBpJyxsSWxsLGxlbihsbDFsKQogICAgICAgIGxsMTEgPSAtMTsKICAgICAgICBpZiAoIG9yZChJMWxJW2xsMUldKSAlIDIpOgogICAgICAgICAgICBsbDExID0gMTsKICAgICAgICAjcHJpbnQgJ3ZhbCBpcyAnLCBsSTFsW2xJbGw6IGxJbGwrMl0KICAgICAgICBsMWxsLmFwcGVuZChjaHIoICAgIGludChsSTFsW2xJbGw6IGxJbGwrMl0sIDM2KSAtIGxsMTEpKTsKICAgICAgICBsbDFJKz0xOwogICAgICAgIGlmIChsbDFJID49IGxlbihsMWxJKSk6CiAgICAgICAgICAgIGxsMUkgPSAwOwogICAgcmV0PScnLmpvaW4obDFsbCkKICAgIGlmICdldmFsKGZ1bmN0aW9uKHcsaSxzLGUpJyBpbiByZXQ6CiAgICAgICAgcHJpbnQgJ1NUSUxMIEdPaW5nJwogICAgICAgIHJldD1yZS5jb21waWxlKCdldmFsXChmdW5jdGlvblwodyxpLHMsZVwpLip9XCgoLio/KVwpJykuZmluZGFsbChyZXQpWzBdIAogICAgICAgIHJldHVybiBnZXRfdW53aXNlKHJldCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQgJ0ZJTklTSEVEJwogICAgICAgIHJldHVybiByZXQKICAgIApkZWYgZ2V0X3VucGFja2VkKCBwYWdlX3ZhbHVlLCByZWdleF9mb3JfdGV4dD0nJywgaXRlcmF0aW9ucz0xLCB0b3RhbF9pdGVyYXRpb249MSk6CiAgICB0cnk6ICAgICAgICAKICAgICAgICByZWdfZGF0YT1Ob25lCiAgICAgICAgaWYgcGFnZV92YWx1ZS5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlKQogICAgICAgIHByaW50ICdwYWdlX3ZhbHVlJyxwYWdlX3ZhbHVlCiAgICAgICAgaWYgcmVnZXhfZm9yX3RleHQgYW5kIGxlbihyZWdleF9mb3JfdGV4dCk+MDoKICAgICAgICAgICAgcGFnZV92YWx1ZT1yZS5jb21waWxlKHJlZ2V4X2Zvcl90ZXh0KS5maW5kYWxsKHBhZ2VfdmFsdWUpWzBdICNnZXQgdGhlIGpzIHZhcmlhYmxlCiAgICAgICAgCiAgICAgICAgcGFnZV92YWx1ZT11bnBhY2socGFnZV92YWx1ZSxpdGVyYXRpb25zLHRvdGFsX2l0ZXJhdGlvbikKICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpCiAgICBwcmludCAndW5wYWNrZWQnLHBhZ2VfdmFsdWUKICAgIGlmICdzYXYxbGl2ZS50dicgaW4gcGFnZV92YWx1ZToKICAgICAgICBwYWdlX3ZhbHVlPXBhZ2VfdmFsdWUucmVwbGFjZSgnc2F2MWxpdmUudHYnLCdzYXdsaXZlLnR2JykgI3F1aWNrIGZpeCBzb21lIGJ1ZyBzb21ld2hlcmUKICAgICAgICBwcmludCAnc2F2MSB1bnBhY2tlZCcscGFnZV92YWx1ZQogICAgcmV0dXJuIHBhZ2VfdmFsdWUKCmRlZiB1bnBhY2soc0phdmFzY3JpcHQsaXRlcmF0aW9uPTEsIHRvdGFsaXRlcmF0aW9ucz0yICApOgogICAgcHJpbnQgJ2l0ZXJhdGlvbicsaXRlcmF0aW9uCiAgICBpZiBzSmF2YXNjcmlwdC5zdGFydHN3aXRoKCd2YXIgXzB4Y2I4YT0nKToKICAgICAgICBhU3BsaXQ9c0phdmFzY3JpcHQuc3BsaXQoJ3ZhciBfMHhjYjhhPScpCiAgICAgICAgc3M9Im15YXJyYXk9IithU3BsaXRbMV0uc3BsaXQoImV2YWwoIilbMF0KICAgICAgICBleGVjKHNzKQogICAgICAgIGExPTYyCiAgICAgICAgYzE9aW50KGFTcGxpdFsxXS5zcGxpdCgiLDYyLCIpWzFdLnNwbGl0KCcsJylbMF0pCiAgICAgICAgcDE9bXlhcnJheVswXQogICAgICAgIGsxPW15YXJyYXlbM10KICAgICAgICB3aXRoIG9wZW4oJ3RlbXAgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6CiAgICAgICAgICAgIGZpbGV3cml0ZXIud3JpdGUoc3RyKGsxKSkKICAgICAgICAjYWE9MS8wCiAgICBlbHNlOgoKICAgICAgICBhU3BsaXQgPSBzSmF2YXNjcmlwdC5zcGxpdCgicm4gcH0oJyIpCiAgICAgICAgcHJpbnQgYVNwbGl0CiAgICAgICAgCiAgICAgICAgcDEsYTEsYzEsazE9KCcnLCcwJywnMCcsJycpCiAgICAgCiAgICAgICAgc3M9InAxLGExLGMxLGsxPSgnIithU3BsaXRbMV0uc3BsaXQoIi5zcGxpIilbMF0rJyknIAogICAgICAgIGV4ZWMoc3MpCiAgICBrMT1rMS5zcGxpdCgnfCcpCiAgICBhU3BsaXQgPSBhU3BsaXRbMV0uc3BsaXQoIikpJyIpCiMgICAgcHJpbnQgJyBwIGFycmF5IGlzICcsbGVuKGFTcGxpdCkKIyAgIHByaW50IGxlbihhU3BsaXQgKQoKICAgICNwPXN0cihhU3BsaXRbMF0rJykpJykjLnJlcGxhY2UoIlxcIiwiIikjLnJlcGxhY2UoJ1xcXFwnLCdcXCcpCgogICAgI3ByaW50IGFTcGxpdFsxXQogICAgI2FTcGxpdCA9IGFTcGxpdFsxXS5zcGxpdCgiLCIpCiAgICAjcHJpbnQgYVNwbGl0WzBdIAogICAgI2EgPSBpbnQoYVNwbGl0WzFdKQogICAgI2MgPSBpbnQoYVNwbGl0WzJdKQogICAgI2sgPSBhU3BsaXRbM10uc3BsaXQoIi4iKVswXS5yZXBsYWNlKCInIiwgJycpLnNwbGl0KCd8JykKICAgICNhPWludChhKQogICAgI2M9aW50KGMpCiAgICAKICAgICNwPXAucmVwbGFjZSgnXFwnLCAnJykKIyAgICBwcmludCAncCB2YWwgaXMgJyxwWzA6MTAwXSwnLi4uLi4uLi4uLi4uJyxwWy0xMDA6XSxsZW4ocCkKIyAgICBwcmludCAncDEgdmFsIGlzICcscDFbMDoxMDBdLCcuLi4uLi4uLi4uLi4nLHAxWy0xMDA6XSxsZW4ocDEpCiAgICAKICAgICNwcmludCBhLGExCiAgICAjcHJpbnQgYyxhMQogICAgI3ByaW50ICdrIHZhbCBpcyAnLGtbLTEwOl0sbGVuKGspCiMgICAgcHJpbnQgJ2sxIHZhbCBpcyAnLGsxWy0xMDpdLGxlbihrMSkKICAgIGUgPSAnJwogICAgZCA9ICcnIzMyODIzCgogICAgI3NVbnBhY2tlZCA9IHN0cihfX3VucGFjayhwLCBhLCBjLCBrLCBlLCBkKSkKICAgIHNVbnBhY2tlZDEgPSBzdHIoX191bnBhY2socDEsIGExLCBjMSwgazEsIGUsIGQsaXRlcmF0aW9uKSkKICAgIAogICAgI3ByaW50IHNVbnBhY2tlZFs6MjAwXSsnLi4uLicrc1VucGFja2VkWy0xMDA6XSwgbGVuKHNVbnBhY2tlZCkKIyAgICBwcmludCBzVW5wYWNrZWQxWzoyMDBdKycuLi4uJytzVW5wYWNrZWQxWy0xMDA6XSwgbGVuKHNVbnBhY2tlZDEpCiAgICAKICAgICNleGVjKCdzVW5wYWNrZWQxPSInK3NVbnBhY2tlZDErJyInKQogICAgaWYgaXRlcmF0aW9uPj10b3RhbGl0ZXJhdGlvbnM6CiMgICAgICAgIHByaW50ICdmaW5hbCByZXMnLHNVbnBhY2tlZDFbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZDFbLTEwMDpdLCBsZW4oc1VucGFja2VkMSkKICAgICAgICByZXR1cm4gc1VucGFja2VkMSMucmVwbGFjZSgnXFxcXCcsICdcXCcpCiAgICBlbHNlOgojICAgICAgICBwcmludCAnZmluYWwgcmVzIGZvciB0aGlzIGl0ZXJhdGlvbiBpcycsaXRlcmF0aW9uCiAgICAgICAgcmV0dXJuIHVucGFjayhzVW5wYWNrZWQxLGl0ZXJhdGlvbisxKSMucmVwbGFjZSgnXFwnLCAnJyksaXRlcmF0aW9uKSMucmVwbGFjZSgnXFwnLCAnJyk7I3VucGFjayhzVW5wYWNrZWQucmVwbGFjZSgnXFwnLCAnJykpCgpkZWYgX191bnBhY2socCwgYSwgYywgaywgZSwgZCwgaXRlcmF0aW9uLHY9MSk6CgogICAgI3dpdGggb3BlbignYmVmb3JlIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOgogICAgIyAgICBmaWxld3JpdGVyLndyaXRlKHN0cihwKSkKICAgIHdoaWxlIChjID49IDEpOgogICAgICAgIGMgPSBjIC0xCiAgICAgICAgaWYgKGtbY10pOgogICAgICAgICAgICBhYT1zdHIoX19pdG9hTmV3KGMsIGEpKQogICAgICAgICAgICBpZiB2PT0xOgogICAgICAgICAgICAgICAgcD1yZS5zdWIoJ1xcYicgKyBhYSArJ1xcYicsIGtbY10sIHApIyBUSElTIElTIEJsb29keSBzbG93IQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcD1maW5kQW5kUmVwbGFjZVdvcmQocCxhYSxrW2NdKQoKICAgICAgICAgICAgI3A9ZmluZEFuZFJlcGxhY2VXb3JkKHAsYWEsa1tjXSkKCiAgICAgICAgICAgIAogICAgI3dpdGggb3BlbignYWZ0ZXIgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6CiAgICAjICAgIGZpbGV3cml0ZXIud3JpdGUoc3RyKHApKQogICAgcmV0dXJuIHAKCiMKI2Z1bmN0aW9uIGVxdWFsYXZlbnQgdG8gcmUuc3ViKCdcXGInICsgYWEgKydcXGInLCBrW2NdLCBwKQpkZWYgZmluZEFuZFJlcGxhY2VXb3JkKHNvdXJjZV9zdHIsIHdvcmRfdG9fZmluZCxyZXBsYWNlX3dpdGgpOgogICAgc3BsaXRzPU5vbmUKICAgIHNwbGl0cz1zb3VyY2Vfc3RyLnNwbGl0KHdvcmRfdG9fZmluZCkKICAgIGlmIGxlbihzcGxpdHMpPjE6CiAgICAgICAgbmV3X3N0cmluZz1bXQogICAgICAgIGN1cnJlbnRfaW5kZXg9MAogICAgICAgIGZvciBjdXJyZW50X3NwbGl0IGluIHNwbGl0czoKICAgICAgICAgICAgI3ByaW50ICdoZXJlJyxpCiAgICAgICAgICAgIG5ld19zdHJpbmcuYXBwZW5kKGN1cnJlbnRfc3BsaXQpCiAgICAgICAgICAgIHZhbD13b3JkX3RvX2ZpbmQjYnkgZGVmYXVsdCBhc3N1bWUgaXQgd2FzIHdyb25nIHRvIHNwbGl0CgogICAgICAgICAgICAjaWYgaXRzIGZpcnN0IG9uZSBhbmQgaXRlbSBpcyBibGFuayB0aGVuIGNoZWNrIG5leHQgaXRlbSBpcyB2YWxpZCBvciBub3QKICAgICAgICAgICAgaWYgY3VycmVudF9pbmRleD09bGVuKHNwbGl0cyktMToKICAgICAgICAgICAgICAgIHZhbD0nJyAjIGxhc3Qgb25lIG5vdGhpbmcgdG8gYXBwZW5kIG5vcm1hbGx5CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBsZW4oY3VycmVudF9zcGxpdCk9PTA6ICNpZiBibGFuayBjaGVjayBuZXh0IG9uZSB3aXRoIGN1cnJlbnQgc3BsaXQgdmFsdWUKICAgICAgICAgICAgICAgICAgICBpZiAoIGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk9PTAgYW5kIHdvcmRfdG9fZmluZFswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIG9yIChsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPjAgIGFuZCBzcGxpdHNbY3VycmVudF9pbmRleCsxXVswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpOiMgZmlyc3QganVzdCBqdXN0IGNoZWNrIG5leHQKICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlcGxhY2Vfd2l0aAogICAgICAgICAgICAgICAgI25vdCBibGFuaywgdGhlbiBjaGVjayBjdXJyZW50IGVuZHZhbHVlIGFuZCBuZXh0IGZpcnN0IHZhbHVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIChzcGxpdHNbY3VycmVudF9pbmRleF1bLTFdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgYW5kICgoIGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk9PTAgYW5kIHdvcmRfdG9fZmluZFswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIG9yIChsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPjAgIGFuZCBzcGxpdHNbY3VycmVudF9pbmRleCsxXVswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpKTojIGZpcnN0IGp1c3QganVzdCBjaGVjayBuZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZXBsYWNlX3dpdGgKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIG5ld19zdHJpbmcuYXBwZW5kKHZhbCkKICAgICAgICAgICAgY3VycmVudF9pbmRleCs9MQogICAgICAgICNhYWFhPTEvMAogICAgICAgIHNvdXJjZV9zdHI9Jycuam9pbihuZXdfc3RyaW5nKQogICAgcmV0dXJuIHNvdXJjZV9zdHIgICAgICAgIAoKZGVmIF9faXRvYShudW0sIHJhZGl4KToKIyAgICBwcmludCAnbnVtIHJlZCcsbnVtLCByYWRpeAogICAgcmVzdWx0ID0gIiIKICAgIGlmIG51bT09MDogcmV0dXJuICcwJwogICAgd2hpbGUgbnVtID4gMDoKICAgICAgICByZXN1bHQgPSAiMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IltudW0gJSByYWRpeF0gKyByZXN1bHQKICAgICAgICBudW0gLz0gcmFkaXgKICAgIHJldHVybiByZXN1bHQKCQpkZWYgX19pdG9hTmV3KGNjLCBhKToKICAgIGFhPSIiIGlmIGNjIDwgYSBlbHNlIF9faXRvYU5ldyhpbnQoY2MgLyBhKSxhKSAKICAgIGNjID0gKGNjICUgYSkKICAgIGJiPWNocihjYyArIDI5KSBpZiBjYz4gMzUgZWxzZSBzdHIoX19pdG9hKGNjLDM2KSkKICAgIHJldHVybiBhYStiYgoKCmRlZiBnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcik6CiAgICB0cnk6CiAgICAgICAgY29va2llU3RyaW5nPSIiCiAgICAgICAgZm9yIGluZGV4LCBjb29raWUgaW4gZW51bWVyYXRlKGNvb2tpZUphcik6CiAgICAgICAgICAgIGNvb2tpZVN0cmluZys9Y29va2llLm5hbWUgKyAiPSIgKyBjb29raWUudmFsdWUgKyI7IgogICAgZXhjZXB0OiBwYXNzCiAgICAjcHJpbnQgJ2Nvb2tpZVN0cmluZycsY29va2llU3RyaW5nCiAgICByZXR1cm4gY29va2llU3RyaW5nCgoKZGVmIHNhdmVDb29raWVKYXIoY29va2llSmFyLENPT0tJRUZJTEUpOgoJdHJ5OgoJCWNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsQ09PS0lFRklMRSkKCQljb29raWVKYXIuc2F2ZShjb21wbGV0ZV9wYXRoLGlnbm9yZV9kaXNjYXJkPVRydWUpCglleGNlcHQ6IHBhc3MKCmRlZiBnZXRDb29raWVKYXIoQ09PS0lFRklMRSk6CgoJY29va2llSmFyPU5vbmUKCWlmIENPT0tJRUZJTEU6CgkJdHJ5OgoJCQljb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLENPT0tJRUZJTEUpCgkJCWNvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQoJCQljb29raWVKYXIubG9hZChjb21wbGV0ZV9wYXRoLGlnbm9yZV9kaXNjYXJkPVRydWUpCgkJZXhjZXB0OiAKCQkJY29va2llSmFyPU5vbmUKCQoJaWYgbm90IGNvb2tpZUphcjoKCQljb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkKCQoJcmV0dXJuIGNvb2tpZUphcgogICAgCmRlZiBkb0V2YWwoZnVuX2NhbGwscGFnZV9kYXRhLENvb2tpZV9KYXIpOgogICAgcmV0X3ZhbD0nJwogICAgaWYgZnVuY3Rpb25zX2RpciBub3QgaW4gc3lzLnBhdGg6CiAgICAgICAgc3lzLnBhdGguYXBwZW5kKGZ1bmN0aW9uc19kaXIpCiAgICAKICAgIHByaW50IGZ1bl9jYWxsCiAgICB0cnk6CiAgICAgICAgcHlfZmlsZT0naW1wb3J0ICcrZnVuX2NhbGwuc3BsaXQoJy4nKVswXQogICAgICAgIHByaW50IHB5X2ZpbGUsc3lzLnBhdGgKICAgICAgICBleGVjKCBweV9maWxlKQogICAgICAgIHByaW50ICdkb25lJwogICAgZXhjZXB0OgogICAgICAgIHByaW50ICdlcnJvciBpbiBpbXBvcnQnCiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpCiAgICBwcmludCAncmV0X3ZhbD0nK2Z1bl9jYWxsCiAgICBleGVjICgncmV0X3ZhbD0nK2Z1bl9jYWxsKQogICAgcHJpbnQgcmV0X3ZhbAogICAgI2V4ZWMoJ3JldF92YWw9MSsxJykKICAgIHJldHVybiBzdHIocmV0X3ZhbCkKICAgIApkZWYgcHJvY2Vzc1JlY2FwdGNoYSh1cmwpOgoJaHRtbF90ZXh0PWdldFVybCh1cmwpCglyZWNhcENoYWxsZW5nZT0iIgoJc29sdXRpb249IiIKCWNhcF9yZWc9IjxzY3JpcHQuKj9zcmM9XCIoLio/cmVjYXAuKj8pXCIiCgltYXRjaCA9cmUuZmluZGFsbChjYXBfcmVnLCBodG1sX3RleHQpCgljYXB0Y2hhPUZhbHNlCgljYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbD1Ob25lCglzb2x1dGlvbj1Ob25lCgkKCWlmIG1hdGNoIGFuZCBsZW4obWF0Y2gpPjA6ICNuZXcgc2hpbnkgY2FwdGNoYSEKCQljYXB0Y2hhX3VybD1tYXRjaFswXQoJCWNhcHRjaGE9VHJ1ZQoJCQoJCWNhcF9jaGFsbF9yZWc9J2NoYWxsZW5nZS4qP1wnKC4qPylcJycKCQljYXBfaW1hZ2VfcmVnPSdcJyguKj8pXCcnCgkJY2FwdGNoYV9zY3JpcHQ9Z2V0VXJsKGNhcHRjaGFfdXJsKQoJCXJlY2FwQ2hhbGxlbmdlPXJlLmZpbmRhbGwoY2FwX2NoYWxsX3JlZywgY2FwdGNoYV9zY3JpcHQpWzBdCgkJY2FwdGNoYV9yZWxvYWQ9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL3JlbG9hZD9jPSc7CgkJY2FwdGNoYV9rPWNhcHRjaGFfdXJsLnNwbGl0KCdrPScpWzFdCgkJY2FwdGNoYV9yZWxvYWQrPXJlY2FwQ2hhbGxlbmdlKycmaz0nK2NhcHRjaGFfaysnJmNhcHRjaGFfaz0xJnR5cGU9aW1hZ2UmbGFuZz1lbi1HQicKCQljYXB0Y2hhX3JlbG9hZF9qcz1nZXRVcmwoY2FwdGNoYV9yZWxvYWQpCgkJY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGw9cmUuZmluZGFsbChjYXBfaW1hZ2VfcmVnLCBjYXB0Y2hhX3JlbG9hZF9qcylbMF0KCQljYXB0Y2hhX2ltYWdlX3VybD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvaW1hZ2U/Yz0nK2NhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsCgkJaWYgbm90IGNhcHRjaGFfaW1hZ2VfdXJsLnN0YXJ0c3dpdGgoImh0dHAiKToKCQkJY2FwdGNoYV9pbWFnZV91cmw9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpLycrY2FwdGNoYV9pbWFnZV91cmwKCQlpbXBvcnQgcmFuZG9tCgkJbj1yYW5kb20ucmFuZHJhbmdlKDEwMCwxMDAwLDUpCgkJbG9jYWxfY2FwdGNoYSA9IG9zLnBhdGguam9pbihwcm9maWxlLHN0cihuKSArImNhcHRjaGEuaW1nIiApCgkJbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQoJCWxvY2FsRmlsZS53cml0ZShnZXRVcmwoY2FwdGNoYV9pbWFnZV91cmwpKQoJCWxvY2FsRmlsZS5jbG9zZSgpCgkJc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQoJCXNvbHV0aW9uID0gc29sdmVyLmdldCgpCgkJb3MucmVtb3ZlKGxvY2FsX2NhcHRjaGEpCglyZXR1cm4gY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGwgLHNvbHV0aW9uCgpkZWYgZ2V0VXJsKHVybCwgY29va2llSmFyPU5vbmUscG9zdD1Ob25lLCB0aW1lb3V0PTIwLCBoZWFkZXJzPU5vbmUpOgoKCgljb29raWVfaGFuZGxlciA9IHVybGxpYjIuSFRUUENvb2tpZVByb2Nlc3Nvcihjb29raWVKYXIpCglvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpCgkjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCglyZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsKQoJcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFdPVzY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMzMuMC4xNzUwLjE1NCBTYWZhcmkvNTM3LjM2JykKCWlmIGhlYWRlcnM6CgkJZm9yIGgsaHYgaW4gaGVhZGVyczoKCQkJcmVxLmFkZF9oZWFkZXIoaCxodikKCglyZXNwb25zZSA9IG9wZW5lci5vcGVuKHJlcSxwb3N0LHRpbWVvdXQ9dGltZW91dCkKCWxpbms9cmVzcG9uc2UucmVhZCgpCglyZXNwb25zZS5jbG9zZSgpCglyZXR1cm4gbGluazsKCmRlZiBnZXRfZGVjb2RlKHN0cixyZWc9Tm9uZSk6CglpZiByZWc6CgkJc3RyPXJlLmZpbmRhbGwocmVnLCBzdHIpWzBdCglzMSA9IHVybGxpYi51bnF1b3RlKHN0clswOiBsZW4oc3RyKS0xXSk7Cgl0ID0gJyc7Cglmb3IgaSBpbiByYW5nZSggbGVuKHMxKSk6CgkJdCArPSBjaHIob3JkKHMxW2ldKSAtIHMxW2xlbihzMSktMV0pOwoJdD11cmxsaWIudW5xdW90ZSh0KQoJcHJpbnQgdAoJcmV0dXJuIHQKCmRlZiBqYXZhc2NyaXB0VW5Fc2NhcGUoc3RyKToKCWpzPXJlLmZpbmRhbGwoJ3VuZXNjYXBlXChcJyguKj8pXCcnLHN0cikKCXByaW50ICdqcycsanMKCWlmIChub3QganM9PU5vbmUpIGFuZCBsZW4oanMpPjA6CgkJZm9yIGogaW4ganM6CgkJCSNwcmludCB1cmxsaWIudW5xdW90ZShqKQoJCQlzdHI9c3RyLnJlcGxhY2UoaiAsdXJsbGliLnVucXVvdGUoaikpCglyZXR1cm4gc3RyCgppaWQ9MApkZWYgYXNrQ2FwdGNoYShtLGh0bWxfcGFnZSwgY29va2llSmFyKToKICAgIGdsb2JhbCBpaWQKICAgIGlpZCs9MQogICAgZXhwcmU9IG1bJ2V4cHJlJ10KICAgIHBhZ2VfdXJsID0gbVsncGFnZSddCiAgICBjYXB0Y2hhX3JlZ2V4PXJlLmNvbXBpbGUoJ1wkTGl2ZVN0cmVhbUNhcHRjaGFcWyhbXlxdXSopXF0nKS5maW5kYWxsKGV4cHJlKVswXQoKICAgIGNhcHRjaGFfdXJsPXJlLmNvbXBpbGUoY2FwdGNoYV9yZWdleCkuZmluZGFsbChodG1sX3BhZ2UpWzBdCiAgICBwcmludCBleHByZSxjYXB0Y2hhX3JlZ2V4LGNhcHRjaGFfdXJsCiAgICBpZiBub3QgY2FwdGNoYV91cmwuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgIHBhZ2VfPSdodHRwOi8vJysiIi5qb2luKHBhZ2VfdXJsLnNwbGl0KCcvJylbMjozXSkKICAgICAgICBpZiBjYXB0Y2hhX3VybC5zdGFydHN3aXRoKCIvIik6CiAgICAgICAgICAgIGNhcHRjaGFfdXJsPXBhZ2VfK2NhcHRjaGFfdXJsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY2FwdGNoYV91cmw9cGFnZV8rJy8nK2NhcHRjaGFfdXJsCiAgICAKICAgIGxvY2FsX2NhcHRjaGEgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgc3RyKGlpZCkrImNhcHRjaGEuanBnIiApCiAgICBsb2NhbEZpbGUgPSBvcGVuKGxvY2FsX2NhcHRjaGEsICJ3YiIpCiAgICBwcmludCAnIGMgY2FwdXJsJyxjYXB0Y2hhX3VybAogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KGNhcHRjaGFfdXJsKQogICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpCiAgICBpZiAncmVmZXInIGluIG06CiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlciddKQogICAgaWYgJ2FnZW50JyBpbiBtOgogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLWFnZW50JywgbVsnYWdlbnQnXSkKICAgIGlmICdzZXRjb29raWUnIGluIG06CiAgICAgICAgcHJpbnQgJ2FkZGluZyBjb29raWUnLG1bJ3NldGNvb2tpZSddCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0Nvb2tpZScsIG1bJ3NldGNvb2tpZSddKQogICAgICAgIAogICAgI2Nvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikKICAgICNvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpCiAgICAjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICB1cmxsaWIyLnVybG9wZW4ocmVxKQogICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQoKICAgIGxvY2FsRmlsZS53cml0ZShyZXNwb25zZS5yZWFkKCkpCiAgICByZXNwb25zZS5jbG9zZSgpCiAgICBsb2NhbEZpbGUuY2xvc2UoKQogICAgc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQogICAgc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkKICAgIHJldHVybiBzb2x1dGlvbgogICAgCmNsYXNzIElucHV0V2luZG93KHhibWNndWkuV2luZG93RGlhbG9nKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgIHNlbGYuY3B0bG9jID0ga3dhcmdzLmdldCgnY2FwdGNoYScpCiAgICAgICAgc2VsZi5pbWcgPSB4Ym1jZ3VpLkNvbnRyb2xJbWFnZSgzMzUsMzAsNjI0LDYwLHNlbGYuY3B0bG9jKQogICAgICAgIHNlbGYuYWRkQ29udHJvbChzZWxmLmltZykKICAgICAgICBzZWxmLmtiZCA9IHhibWMuS2V5Ym9hcmQoKQoKICAgIGRlZiBnZXQoc2VsZik6CiAgICAgICAgc2VsZi5zaG93KCkKICAgICAgICB0aW1lLnNsZWVwKDIpICAgICAgICAKICAgICAgICBzZWxmLmtiZC5kb01vZGFsKCkKICAgICAgICBpZiAoc2VsZi5rYmQuaXNDb25maXJtZWQoKSk6CiAgICAgICAgICAgIHRleHQgPSBzZWxmLmtiZC5nZXRUZXh0KCkKICAgICAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAgICAgICAgIHJldHVybiB0ZXh0CiAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKZGVmIGdldEVwb2NUaW1lKCk6CiAgICBpbXBvcnQgdGltZQogICAgcmV0dXJuIHN0cihpbnQodGltZS50aW1lKCkqMTAwMCkpCgpkZWYgZ2V0RXBvY1RpbWUyKCk6CiAgICBpbXBvcnQgdGltZQogICAgcmV0dXJuIHN0cihpbnQodGltZS50aW1lKCkpKQoKZGVmIGdldF9wYXJhbXMoKToKICAgICAgICBwYXJhbT1bXQogICAgICAgIHBhcmFtc3RyaW5nPXN5cy5hcmd2WzJdCiAgICAgICAgaWYgbGVuKHBhcmFtc3RyaW5nKT49MjoKICAgICAgICAgICAgcGFyYW1zPXN5cy5hcmd2WzJdCiAgICAgICAgICAgIGNsZWFuZWRwYXJhbXM9cGFyYW1zLnJlcGxhY2UoJz8nLCcnKQogICAgICAgICAgICBpZiAocGFyYW1zW2xlbihwYXJhbXMpLTFdPT0nLycpOgogICAgICAgICAgICAgICAgcGFyYW1zPXBhcmFtc1swOmxlbihwYXJhbXMpLTJdCiAgICAgICAgICAgIHBhaXJzb2ZwYXJhbXM9Y2xlYW5lZHBhcmFtcy5zcGxpdCgnJicpCiAgICAgICAgICAgIHBhcmFtPXt9CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihwYWlyc29mcGFyYW1zKSk6CiAgICAgICAgICAgICAgICBzcGxpdHBhcmFtcz17fQogICAgICAgICAgICAgICAgc3BsaXRwYXJhbXM9cGFpcnNvZnBhcmFtc1tpXS5zcGxpdCgnPScpCiAgICAgICAgICAgICAgICBpZiAobGVuKHNwbGl0cGFyYW1zKSk9PTI6CiAgICAgICAgICAgICAgICAgICAgcGFyYW1bc3BsaXRwYXJhbXNbMF1dPXNwbGl0cGFyYW1zWzFdCiAgICAgICAgcmV0dXJuIHBhcmFtCgoKZGVmIGdldEZhdm9yaXRlcygpOgogICAgICAgIGl0ZW1zID0ganNvbi5sb2FkcyhvcGVuKGZhdm9yaXRlcykucmVhZCgpKQogICAgICAgIHRvdGFsID0gbGVuKGl0ZW1zKQogICAgICAgIGZvciBpIGluIGl0ZW1zOgogICAgICAgICAgICBuYW1lID0gaVswXQogICAgICAgICAgICB1cmwgPSBpWzFdCiAgICAgICAgICAgIGljb25pbWFnZSA9IGlbMl0KICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZmFuQXJ0ID0gaVszXQogICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGljb25pbWFnZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICAgICAgdHJ5OiBwbGF5bGlzdCA9IGlbNV0KICAgICAgICAgICAgZXhjZXB0OiBwbGF5bGlzdCA9IE5vbmUKICAgICAgICAgICAgdHJ5OiByZWdleHMgPSBpWzZdCiAgICAgICAgICAgIGV4Y2VwdDogcmVnZXhzID0gTm9uZQoKICAgICAgICAgICAgaWYgaVs0XSA9PSAwOgogICAgICAgICAgICAgICAgYWRkTGluayh1cmwsbmFtZSxpY29uaW1hZ2UsZmFuQXJ0LCcnLCcnLCcnLCdmYXYnLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCxpWzRdLGljb25pbWFnZSxmYW5hcnQsJycsJycsJycsJycsJ2ZhdicpCgoKZGVmIGFkZEZhdm9yaXRlKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSxwbGF5bGlzdD1Ob25lLHJlZ2V4cz1Ob25lKToKICAgICAgICBmYXZMaXN0ID0gW10KICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzICsgJ3R4dCcpOgogICAgICAgICAgICBvcy5tYWtlZGlycyhmYXZvcml0ZXMgKyAndHh0JykKICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoaGlzdG9yeSk6CiAgICAgICAgICAgIG9zLm1ha2VkaXJzKGhpc3RvcnkpCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIHNlZW1zIHRoYXQgYWZ0ZXIKICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcyk9PUZhbHNlOgogICAgICAgICAgICBhZGRvbl9sb2coJ01ha2luZyBGYXZvcml0ZXMgRmlsZScpCiAgICAgICAgICAgIGZhdkxpc3QuYXBwZW5kKChuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUscGxheWxpc3QscmVnZXhzKSkKICAgICAgICAgICAgYSA9IG9wZW4oZmF2b3JpdGVzLCAidyIpCiAgICAgICAgICAgIGEud3JpdGUoanNvbi5kdW1wcyhmYXZMaXN0KSkKICAgICAgICAgICAgYS5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCdBcHBlbmRpbmcgRmF2b3JpdGVzJykKICAgICAgICAgICAgYSA9IG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkKICAgICAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMoYSkKICAgICAgICAgICAgZGF0YS5hcHBlbmQoKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSkpCiAgICAgICAgICAgIGIgPSBvcGVuKGZhdm9yaXRlcywgInciKQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoZGF0YSkpCiAgICAgICAgICAgIGIuY2xvc2UoKQoKCmRlZiBybUZhdm9yaXRlKG5hbWUpOgogICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkpCiAgICAgICAgZm9yIGluZGV4IGluIHJhbmdlKGxlbihkYXRhKSk6CiAgICAgICAgICAgIGlmIGRhdGFbaW5kZXhdWzBdPT1uYW1lOgogICAgICAgICAgICAgICAgZGVsIGRhdGFbaW5kZXhdCiAgICAgICAgICAgICAgICBiID0gb3BlbihmYXZvcml0ZXMsICJ3IikKICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhkYXRhKSkKICAgICAgICAgICAgICAgIGIuY2xvc2UoKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5SZWZyZXNoIikKCmRlZiB1cmxzb2x2ZXIodXJsKToKICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ1VwZGF0ZWNvbW1vbnJlc29sdmVycycpID09ICd0cnVlJzoKICAgICAgICBsID0gb3MucGF0aC5qb2luKGhvbWUsJ2dlbmVzaXNyZXNvbHZlcnMucHknKQogICAgICAgIGlmIHhibWN2ZnMuZXhpc3RzKGwpOgogICAgICAgICAgICBvcy5yZW1vdmUobCkKCiAgICAgICAgZ2VuZXNpc191cmwgPSAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2xhbWJkYTgxL2xhbWJkYS1hZGRvbnMvbWFzdGVyL3BsdWdpbi52aWRlby5nZW5lc2lzL2NvbW1vbnJlc29sdmVycy5weScKICAgICAgICB0aD0gdXJsbGliLnVybHJldHJpZXZlKGdlbmVzaXNfdXJsLGwpCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygnVXBkYXRlY29tbW9ucmVzb2x2ZXJzJywgJ2ZhbHNlJykKICAgIHRyeToKICAgICAgICBpbXBvcnQgZ2VuZXNpc3Jlc29sdmVycwogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihTa3luZXQsUGxlYXNlIGVuYWJsZSBVcGRhdGUgQ29tbW9ucmVzb2x2ZXJzIHRvIFBsYXkgaW4gU2V0dGluZ3MuIC0gLDEwMDAwKSIpCgogICAgcmVzb2x2ZWQ9Z2VuZXNpc3Jlc29sdmVycy5nZXQodXJsKS5yZXN1bHQKICAgIGlmIHVybCA9PSByZXNvbHZlZCBvciByZXNvbHZlZCBpcyBOb25lOgogICAgICAgICNpbXBvcnQKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihTa3luZXQsSXMgRmluZGluZyBZb3VyIExpbmsgLSAsNTAwMCkiKQogICAgICAgIGltcG9ydCByZXNvbHZldXJsCiAgICAgICAgaG9zdCA9IHJlc29sdmV1cmwuSG9zdGVkTWVkaWFGaWxlKHVybCkKICAgICAgICBpZiBob3N0OgogICAgICAgICAgICByZXNvbHZlciA9IHJlc29sdmV1cmwucmVzb2x2ZSh1cmwpCiAgICAgICAgICAgIHJlc29sdmVkID0gcmVzb2x2ZXIKICAgIGlmIHJlc29sdmVkIDoKICAgICAgICBpZiBpc2luc3RhbmNlKHJlc29sdmVkLGxpc3QpOgogICAgICAgICAgICBmb3IgayBpbiByZXNvbHZlZDoKICAgICAgICAgICAgICAgIHF1YWxpdHkgPSBhZGRvbi5nZXRTZXR0aW5nKCdxdWFsaXR5JykKICAgICAgICAgICAgICAgIGlmIGtbJ3F1YWxpdHknXSA9PSAnSEQnICA6CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbGlmIGtbJ3F1YWxpdHknXSA9PSAnU0QnIDoKICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddCiAgICAgICAgICAgICAgICBlbGlmIGtbJ3F1YWxpdHknXSA9PSAnMTA4MHAnIGFuZCBhZGRvbi5nZXRTZXR0aW5nKCcxMDgwcHF1YWxpdHknKSA9PSAndHJ1ZScgOgogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10KICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJlc29sdmVyID0gcmVzb2x2ZWQKICAgIHJldHVybiByZXNvbHZlcgpkZWYgcGxheV9wbGF5bGlzdChuYW1lLCBtdV9wbGF5bGlzdCk6CiAgICAgICAgaW1wb3J0IHVybHBhcnNlCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYXNrX3BsYXlsaXN0X2l0ZW1zJykgPT0gJ3RydWUnOgogICAgICAgICAgICBuYW1lcyA9IFtdCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0OgogICAgICAgICAgICAgICAgZF9uYW1lPXVybHBhcnNlLnVybHBhcnNlKGkpLm5ldGxvYwogICAgICAgICAgICAgICAgaWYgZF9uYW1lID09ICcnOgogICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChuYW1lKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBuYW1lcy5hcHBlbmQoZF9uYW1lKQogICAgICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICAgICAgICAgIGluZGV4ID0gZGlhbG9nLnNlbGVjdCgnQ2hvb3NlIGEgdmlkZW8gc291cmNlJywgbmFtZXMpCiAgICAgICAgICAgIGlmIGluZGV4ID49IDA6CiAgICAgICAgICAgICAgICBpZiAiJm1vZGU9MTkiIGluIG11X3BsYXlsaXN0W2luZGV4XToKICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpKSkKICAgICAgICAgICAgICAgIGVsaWYgIiRkb3JlZ2V4IiBpbiBtdV9wbGF5bGlzdFtpbmRleF0gOgoKICAgICAgICAgICAgICAgICAgICBzZXBhdGUgPSBtdV9wbGF5bGlzdFtpbmRleF0uc3BsaXQoJyZyZWdleHM9JykKCiAgICAgICAgICAgICAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQoc2VwYXRlWzFdLCBzZXBhdGVbMF0pCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdXJsID0gbXVfcGxheWxpc3RbaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBwbGF5bGlzdCA9IHhibWMuUGxheUxpc3QoMSkgIyAxIG1lYW5zIHZpZGVvCiAgICAgICAgICAgIHBsYXlsaXN0LmNsZWFyKCkKICAgICAgICAgICAgaXRlbSA9IDAKICAgICAgICAgICAgZm9yIGkgaW4gbXVfcGxheWxpc3Q6CiAgICAgICAgICAgICAgICBpdGVtICs9IDEKICAgICAgICAgICAgICAgIGluZm8gPSB4Ym1jZ3VpLkxpc3RJdGVtKCclcykgJXMnICUoc3RyKGl0ZW0pLG5hbWUpKQogICAgICAgICAgICAgICAgcGxheWxpc3QuYWRkKGksIGluZm8pCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdwbGF5bGlzdC5wbGF5b2Zmc2V0KHZpZGVvLDApJykKCgpkZWYgZG93bmxvYWRfZmlsZShuYW1lLCB1cmwpOgogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKSA9PSAiIjoKICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oJ1NreW5ldCcsJ0Nob29zZSBhIGxvY2F0aW9uIHRvIHNhdmUgZmlsZXMuJywxNTAwMCwiK2ljb24rIikiKQogICAgICAgICAgICBhZGRvbi5vcGVuU2V0dGluZ3MoKQogICAgICAgIHBhcmFtcyA9IHsndXJsJzogdXJsLCAnZG93bmxvYWRfcGF0aCc6IGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKX0KICAgICAgICBkb3dubG9hZGVyLmRvd25sb2FkKG5hbWUsIHBhcmFtcykKICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICAgICAgcmV0ID0gZGlhbG9nLnllc25vKCdTa3luZXQnLCAnRG8geW91IHdhbnQgdG8gYWRkIHRoaXMgZmlsZSBhcyBhIHNvdXJjZT8nKQogICAgICAgIGlmIHJldDoKICAgICAgICAgICAgYWRkU291cmNlKG9zLnBhdGguam9pbihhZGRvbi5nZXRTZXR0aW5nKCdzYXZlX2xvY2F0aW9uJyksIG5hbWUpKQoKCmRlZiBhZGREaXIobmFtZSx1cmwsbW9kZSxpY29uaW1hZ2UsZmFuYXJ0LGRlc2NyaXB0aW9uLGdlbnJlLGRhdGUsY3JlZGl0cyxzaG93Y29udGV4dD1GYWxzZSk6CiAgICAgICAgCiAgICAgICAgdT1zeXMuYXJndlswXSsiP3VybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrc3RyKG1vZGUpKyImbmFtZT0iK3VybGxpYi5xdW90ZV9wbHVzKG5hbWUpKyImaWNvbmltYWdlPSIrdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlKSsiJmZhbmFydD0iK3VybGxpYi5xdW90ZV9wbHVzKGZhbmFydCkKICAgICAgICBvaz1UcnVlCiAgICAgICAgaWYgZGF0ZSA9PSAnJzoKICAgICAgICAgICAgZGF0ZSA9IE5vbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICBkZXNjcmlwdGlvbiArPSAnXG5cbkRhdGU6ICVzJyAlZGF0ZQogICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT0iRGVmYXVsdEZvbGRlci5wbmciLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpCiAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPXsgIlRpdGxlIjogbmFtZSwgIlBsb3QiOiBkZXNjcmlwdGlvbiwgIkdlbnJlIjogZ2VucmUsICJkYXRlYWRkZWQiOiBkYXRlLCAiY3JlZGl0cyI6IGNyZWRpdHMgfSkKICAgICAgICBsaXouc2V0UHJvcGVydHkoIkZhbmFydF9JbWFnZSIsIGZhbmFydCkKICAgICAgICBpZiBzaG93Y29udGV4dDoKICAgICAgICAgICAgY29udGV4dE1lbnUgPSBbXQogICAgICAgICAgICBpZiBzaG93Y29udGV4dCA9PSAnc291cmNlJzoKICAgICAgICAgICAgICAgIGlmIG5hbWUgaW4gc3RyKFNPVVJDRVMpOgogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1JlbW92ZSBmcm9tIFNvdXJjZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTgmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgIGVsaWYgc2hvd2NvbnRleHQgPT0gJ2Rvd25sb2FkJzoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0Rvd25sb2FkJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9OSZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICAgICAgZWxpZiBzaG93Y29udGV4dCA9PSAnZmF2JzoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1JlbW92ZSBmcm9tIEFkZC1vbiBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTYmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCgkJCQkJCQkJCQogICAgICAgICAgICBpZiBub3QgbmFtZSBpbiBGQVY6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdBZGQgdG8gQWRkLW9uIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NSZuYW1lPSVzJnVybD0lcyZpY29uaW1hZ2U9JXMmZmFuYXJ0PSVzJmZhdl9tb2RlPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpLCB1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpLCBtb2RlKSkpCiAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51KQogICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9dSxsaXN0aXRlbT1saXosaXNGb2xkZXI9VHJ1ZSkKCiAgICAgICAgcmV0dXJuIG9rCmRlZiB5dGRsX2Rvd25sb2FkKHVybCx0aXRsZSxtZWRpYV90eXBlPSd2aWRlbycpOgogICAgIyBwbGF5IGluIHhibWMgd2hpbGUgcGxheWluZyBnbyBiYWNrIHRvIGNvbnRleHRNZW51KGMpIHRvICIhIURvd25sb2FkISEiCiAgICAjIFRyaWFsIHlhc2NlZW46IHNlcGVyYXRlIHxVc2VyLUFnZW50PQogICAgaW1wb3J0IHlvdXR1YmVkbAogICAgaWYgbm90IHVybCA9PSAnJzoKICAgICAgICBpZiBtZWRpYV90eXBlPT0gJ2F1ZGlvJzoKICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCh1cmwsZG93bmxvYWQ9VHJ1ZSxhdWRpbz1UcnVlKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQodXJsLGRvd25sb2FkPVRydWUpICAgCiAgICBlbGlmIHhibWMuUGxheWVyKCkuaXNQbGF5aW5nKCkgPT0gVHJ1ZSA6CiAgICAgICAgaW1wb3J0IFlEU3RyZWFtRXh0cmFjdG9yCiAgICAgICAgaWYgWURTdHJlYW1FeHRyYWN0b3IuaXNEb3dubG9hZGluZygpID09IFRydWU6CgogICAgICAgICAgICBZRFN0cmVhbUV4dHJhY3Rvci5tYW5hZ2VEb3dubG9hZHMoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHhibWNfdXJsID0geGJtYy5QbGF5ZXIoKS5nZXRQbGF5aW5nRmlsZSgpCgogICAgICAgICAgICB4Ym1jX3VybCA9IHhibWNfdXJsLnNwbGl0KCd8VXNlci1BZ2VudD0nKVswXQogICAgICAgICAgICBpbmZvID0geyd1cmwnOnhibWNfdXJsLCd0aXRsZSc6dGl0bGUsJ21lZGlhX3R5cGUnOm1lZGlhX3R5cGV9CiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQoJycsZG93bmxvYWQ9VHJ1ZSxkbF9pbmZvPWluZm8pICAgIAogICAgZWxzZToKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihET1dOTE9BRCxGaXJzdCBQbGF5IFtDT0xPUiB5ZWxsb3ddV0hJTEUgcGxheWluZyBkb3dubG9hZFsvQ09MT1JdICwxMDAwMCkiKQogCmRlZiBzZWFyY2goc2l0ZV9uYW1lLHNlYXJjaF90ZXJtPU5vbmUpOgogICAgdGh1bWJuYWlsPScnCiAgICBpZiBvcy5wYXRoLmV4aXN0cyhoaXN0b3J5KSA9PSBGYWxzZSBvciBhZGRvbi5nZXRTZXR0aW5nKCdjbGVhcnNlYWNoaGlzdG9yeScpPT0ndHJ1ZSc6CiAgICAgICAgU2F2ZVRvRmlsZShoaXN0b3J5LCcnKQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoImNsZWFyc2VhY2hoaXN0b3J5IiwiZmFsc2UiKQogICAgaWYgc2l0ZV9uYW1lID09ICdoaXN0b3J5JyA6CiAgICAgICAgY29udGVudCA9IExvYWRGaWxlKGhpc3RvcnkpCiAgICAgICAgbWF0Y2ggPSByZS5jb21waWxlKCcoLis/KTooLio/KSg/OlxyfFxuKScpLmZpbmRhbGwoY29udGVudCkKCiAgICAgICAgZm9yIG5hbWUsc2VhcmNoX3Rlcm0gaW4gbWF0Y2g6CiAgICAgICAgICAgIGlmICdwbHVnaW46Ly8nIGluIHNlYXJjaF90ZXJtOgogICAgICAgICAgICAgICAgYWRkTGluayhzZWFyY2hfdGVybSwgbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbD1pbnQobGVuKG1hdGNoKSkpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSsnOicrc2VhcmNoX3Rlcm0sbmFtZSwyNixpY29uLEZBTkFSVCwnJywnJywnJywnJykKICAgIGlmIG5vdCBzZWFyY2hfdGVybTogICAgCiAgICAgICAga2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKCcnLCdFbnRlciBTZWFyY2ggVGVybScpCiAgICAgICAga2V5Ym9hcmQuZG9Nb2RhbCgpCiAgICAgICAgaWYgKGtleWJvYXJkLmlzQ29uZmlybWVkKCkgPT0gRmFsc2UpOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBzZWFyY2hfdGVybSA9IGtleWJvYXJkLmdldFRleHQoKQogICAgICAgIGlmIGxlbihzZWFyY2hfdGVybSkgPT0gMDoKICAgICAgICAgICAgcmV0dXJuICAgICAgICAKICAgIHNlYXJjaF90ZXJtID0gc2VhcmNoX3Rlcm0ucmVwbGFjZSgnICcsJysnKQogICAgc2VhcmNoX3Rlcm0gPSBzZWFyY2hfdGVybS5lbmNvZGUoJ3V0Zi04JykKICAgIGlmICd5b3V0dWJlJyBpbiBzaXRlX25hbWU6CiAgICAgICAgI3lvdXR1YmUgPSB5b3V0dWJlI0xhbmEgRGVsIFJleQogICAgICAgIGltcG9ydCBfeXRwbGlzdAoKICAgICAgICBzZWFyY2hfcmVzID0ge30KICAgICAgICBzZWFyY2hfcmVzID0gX3l0cGxpc3QuWW9VVHViZSgnc2VhcmNoWVQnLHlvdXR1YmU9c2VhcmNoX3Rlcm0sbWF4X3BhZ2U9NCxub3NhdmU9J25vc2F2ZScpCiAgICAgICAgdG90YWwgPSBsZW4oc2VhcmNoX3JlcykKICAgICAgICBmb3IgaXRlbSBpbiBzZWFyY2hfcmVzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBuYW1lID0gc2VhcmNoX3Jlc1tpdGVtXVsndGl0bGUnXQogICAgICAgICAgICAgICAgZGF0ZT0gc2VhcmNoX3Jlc1tpdGVtXVsnZGF0ZSddCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBzZWFyY2hfcmVzW2l0ZW1dWydkZXNjJ10KICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAnVU5BVkFJQUJMRScKCiAgICAgICAgICAgICAgICB1cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/dmlkZW9faWQ9JyArIHNlYXJjaF9yZXNbaXRlbV1bJ3VybCddCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSdodHRwOi8vaW1nLnlvdXR1YmUuY29tL3ZpLycrc2VhcmNoX3Jlc1tpdGVtXVsndXJsJ10rJy8wLmpwZycKICAgICAgICAgICAgICAgIGFkZExpbmsodXJsLCBuYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLCcnLHRvdGFsKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAJYWRkb25fbG9nKCAnVGhpcyBpdGVtIGlzIGlnbm9yZWQ6OicpCiAgICAgICAgcGFnZV9kYXRhID0gc2l0ZV9uYW1lICsnOicrIHNlYXJjaF90ZXJtICsgJ1xuJwogICAgICAgIFNhdmVUb0ZpbGUob3MucGF0aC5qb2luKHByb2ZpbGUsJ2hpc3RvcnknKSxwYWdlX2RhdGEsYXBwZW5kPVRydWUpCiAgICBlbGlmICdkbW90aW9uJyBpbiBzaXRlX25hbWU6CiAgICAgICAgdXJsTWFpbiA9ICJodHRwczovL2FwaS5kYWlseW1vdGlvbi5jb20iIAogICAgICAgICN5b3V0dWJlID0geW91dHViZSNMYW5hIERlbCBSZXkKICAgICAgICBpbXBvcnQgX0RNc2VhcmNoCiAgICAgICAgZmFtaWx5RmlsdGVyID0gc3RyKGFkZG9uLmdldFNldHRpbmcoJ2ZhbWlseUZpbHRlcicpKQogICAgICAgIF9ETXNlYXJjaC5saXN0VmlkZW9zKHVybE1haW4rIi92aWRlb3M/ZmllbGRzPWRlc2NyaXB0aW9uLGR1cmF0aW9uLGlkLG93bmVyLnVzZXJuYW1lLHRha2VuX3RpbWUsdGh1bWJuYWlsX2xhcmdlX3VybCx0aXRsZSx2aWV3c190b3RhbCZzZWFyY2g9IitzZWFyY2hfdGVybSsiJnNvcnQ9cmVsZXZhbmNlJmxpbWl0PTEwMCZmYW1pbHlfZmlsdGVyPSIrZmFtaWx5RmlsdGVyKyImbG9jYWxpemF0aW9uPWVuX0VOJnBhZ2U9MSIpCiAgICAKICAgICAgICBwYWdlX2RhdGEgPSBzaXRlX25hbWUgKyc6Jysgc2VhcmNoX3Rlcm0rICdcbicKICAgICAgICBTYXZlVG9GaWxlKG9zLnBhdGguam9pbihwcm9maWxlLCdoaXN0b3J5JykscGFnZV9kYXRhLGFwcGVuZD1UcnVlKSAgICAgICAgCiAgICBlbGlmICdJTURCaWRwbGF5JyBpbiBzaXRlX25hbWU6CiAgICAgICAgdXJsTWFpbiA9ICJodHRwOi8vd3d3Lm9tZGJhcGkuY29tLz90PSIgCiAgICAgICAgdXJsPSB1cmxNYWluK3NlYXJjaF90ZXJtCgogICAgICAgIGhlYWRlcnMgPSBkaWN0KHsnVXNlci1BZ2VudCc6J01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMzsgcnY6MzMuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8zMy4wJywnUmVmZXJlcic6ICdodHRwOi8vam9rZXIub3JnLycsJ0FjY2VwdC1FbmNvZGluZyc6J2d6aXAsIGRlZmxhdGUnLCdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04JywnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKid9KQogICAgCiAgICAgICAgcj1yZXF1ZXN0cy5nZXQodXJsLGhlYWRlcnM9aGVhZGVycykKICAgICAgICBkYXRhID0gci5qc29uKCkKICAgICAgICByZXMgPSBkYXRhWydSZXNwb25zZSddCiAgICAgICAgaWYgcmVzID09ICdUcnVlJzoKICAgICAgICAgICAgaW1kYklEID0gZGF0YVsnaW1kYklEJ10KICAgICAgICAgICAgbmFtZT0gZGF0YVsnVGl0bGUnXSArIGRhdGFbJ1JlbGVhc2VkJ10KICAgICAgICAgICAgZGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQogICAgICAgICAgICByZXQgPSBkaWFsb2cueWVzbm8oJ0NoZWNrIE1vdmllIFRpdGxlJywgJ1BMQVkgOjogJXMgPyclbmFtZSkKICAgICAgICAgICAgaWYgcmV0OgogICAgICAgICAgICAgICAgdXJsID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wdWxzYXIvbW92aWUvJytpbWRiSUQrJy9wbGF5JwogICAgICAgICAgICAgICAgcGFnZV9kYXRhID0gbmFtZSArJzonKyB1cmwrICdcbicKICAgICAgICAgICAgICAgIFNhdmVUb0ZpbGUoaGlzdG9yeSxwYWdlX2RhdGEsYXBwZW5kPVRydWUpCiAgICAgICAgICAgICAgICByZXR1cm4gdXJsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oU2ltcGxlS29yZSxObyBJTURCIG1hdGNoIGZvdW5kICw3MDAwLCIraWNvbisiKSIpCiMjIEx1bmF0aXh6IFBzZXVkb1RWIGZlYXR1cmUKZGVmIGFzY2lpKHN0cmluZyk6CiAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgYmFzZXN0cmluZyk6CiAgICAgICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIHVuaWNvZGUpOgogICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5lbmNvZGUoJ2FzY2lpJywgJ2lnbm9yZScpCiAgICByZXR1cm4gc3RyaW5nCmRlZiB1bmkoc3RyaW5nLCBlbmNvZGluZyA9ICd1dGYtOCcpOgogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHN0cmluZywgdW5pY29kZSk6CiAgICAgICAgICAgIHN0cmluZyA9IHVuaWNvZGUoc3RyaW5nLCBlbmNvZGluZywgJ2lnbm9yZScpCiAgICByZXR1cm4gc3RyaW5nCmRlZiByZW1vdmVOb25Bc2NpaShzKTogcmV0dXJuICIiLmpvaW4oZmlsdGVyKGxhbWJkYSB4OiBvcmQoeCk8MTI4LCBzKSkKCmRlZiBzZW5kSlNPTiggY29tbWFuZCk6CiAgICBkYXRhID0gJycKICAgIHRyeToKICAgICAgICBkYXRhID0geGJtYy5leGVjdXRlSlNPTlJQQyh1bmkoY29tbWFuZCkpCiAgICBleGNlcHQgVW5pY29kZUVuY29kZUVycm9yOgogICAgICAgIGRhdGEgPSB4Ym1jLmV4ZWN1dGVKU09OUlBDKGFzY2lpKGNvbW1hbmQpKQoKICAgIHJldHVybiB1bmkoZGF0YSkKCiNoYWthbWFjIHRoYW5rcyBSb21hbl9WX00KZGVmIFNldFZpZXdUaHVtYm5haWwoKToKICAgIHNraW5fdXNlZCA9IHhibWMuZ2V0U2tpbkRpcigpCiAgICBpZiBza2luX3VzZWQgPT0gJ3NraW4uY29uZmx1ZW5jZSc6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCknKQogICAgZWxpZiBza2luX3VzZWQgPT0gJ3NraW4uYWVvbi5ub3gnOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ0NvbnRhaW5lci5TZXRWaWV3TW9kZSg1MTEpJykgCiAgICBlbHNlOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ0NvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApJykKCQoJCmRlZiBwbHVnaW5xdWVyeWJ5SlNPTih1cmwpOgogICAganNvbl9xdWVyeSA9IHVuaSgneyJqc29ucnBjIjoiMi4wIiwibWV0aG9kIjoiRmlsZXMuR2V0RGlyZWN0b3J5IiwicGFyYW1zIjp7ImRpcmVjdG9yeSI6IiVzIiwibWVkaWEiOiJ2aWRlbyIsInByb3BlcnRpZXMiOlsidGh1bWJuYWlsIiwidGl0bGUiLCJ5ZWFyIiwiZGF0ZWFkZGVkIiwiZmFuYXJ0IiwicmF0aW5nIiwic2Vhc29uIiwiZXBpc29kZSIsInN0dWRpbyJdfSwiaWQiOjF9JykgJXVybAoKICAgIGpzb25fZm9sZGVyX2RldGFpbCA9IGpzb24ubG9hZHMoc2VuZEpTT04oanNvbl9xdWVyeSkpCiAgICBmb3IgaSBpbiBqc29uX2ZvbGRlcl9kZXRhaWxbJ3Jlc3VsdCddWydmaWxlcyddIDoKICAgICAgICB1cmwgPSBpWydmaWxlJ10KICAgICAgICBuYW1lID0gcmVtb3ZlTm9uQXNjaWkoaVsnbGFiZWwnXSkKICAgICAgICB0aHVtYm5haWwgPSByZW1vdmVOb25Bc2NpaShpWyd0aHVtYm5haWwnXSkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZhbmFydCA9IHJlbW92ZU5vbkFzY2lpKGlbJ2ZhbmFydCddKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGZhbmFydCA9ICcnCiAgICAgICAgdHJ5OgogICAgICAgICAgICBkYXRlID0gaVsneWVhciddCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZGF0ZSA9ICcnCiAgICAgICAgdHJ5OgogICAgICAgICAgICBlcGlzb2RlID0gaVsnZXBpc29kZSddCiAgICAgICAgICAgIHNlYXNvbiA9IGlbJ3NlYXNvbiddCiAgICAgICAgICAgIGlmIGVwaXNvZGUgPT0gLTEgb3Igc2Vhc29uID09IC0xOgogICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAnJwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAnW0NPTE9SIHllbGxvd10gUycgKyBzdHIoc2Vhc29uKSsnWy9DT0xPUl1bQ09MT1IgaG90cGlua10gRScgKyBzdHIoZXBpc29kZSkgKydbL0NPTE9SXScKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICcnCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzdHVkaW8gPSBpWydzdHVkaW8nXQogICAgICAgICAgICBpZiBzdHVkaW86CiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiArPSAnXG4gU3R1ZGlvOltDT0xPUiBzdGVlbGJsdWVdICcgKyBzdHVkaW9bMF0gKyAnWy9DT0xPUl0nCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgc3R1ZGlvID0gJycKCiAgICAgICAgaWYgaVsnZmlsZXR5cGUnXSA9PSAnZmlsZSc6CiAgICAgICAgICAgIGFkZExpbmsodXJsLG5hbWUsdGh1bWJuYWlsLGZhbmFydCxkZXNjcmlwdGlvbiwnJyxkYXRlLCcnLE5vbmUsJycsdG90YWw9bGVuKGpzb25fZm9sZGVyX2RldGFpbFsncmVzdWx0J11bJ2ZpbGVzJ10pKQogICAgICAgICAgICAjeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCkiKQoKICAgICAgICBlbHNlOgogICAgICAgICAgICBhZGREaXIobmFtZSx1cmwsNTMsdGh1bWJuYWlsLGZhbmFydCxkZXNjcmlwdGlvbiwnJyxkYXRlLCcnKQogICAgICAgICAgICAjeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCkiKQoKZGVmIGFkZExpbmsodXJsLG5hbWUsaWNvbmltYWdlLGZhbmFydCxkZXNjcmlwdGlvbixnZW5yZSxkYXRlLHNob3djb250ZXh0LHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCxzZXRDb29raWU9IiIpOgogICAgICAgICNwcmludCAndXJsLG5hbWUnLHVybCxuYW1lCiAgICAgICAgY29udGV4dE1lbnUgPVtdCiAgICAgICAgdHJ5OgogICAgICAgICAgICBuYW1lID0gbmFtZS5lbmNvZGUoJ3V0Zi04JykKICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICBvayA9IFRydWUKICAgICAgIAogICAgICAgIGlmIHJlZ2V4czogCiAgICAgICAgICAgIG1vZGUgPSAnMTcnCiAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkIEN1cnJlbnRseSBQbGF5aW5nISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIxJm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAgICAgICAgICAgCiAgICAgICAgZWxpZiAgYW55KHggaW4gdXJsIGZvciB4IGluIHJlc29sdmVfdXJsKSBhbmQgIHVybC5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgIG1vZGUgPSAnMTknCiAgICAgICAgICAKICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpICAgICAgICAgICAKICAgICAgICBlbGlmIHVybC5lbmRzd2l0aCgnJm1vZGU9MTgnKToKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCcmbW9kZT0xOCcsJycpCiAgICAgICAgICAgIG1vZGUgPSAnMTgnIAogICAgICAgICAgCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIzJm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAKICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnZGxhdWRpb29ubHknKSA9PSAndHJ1ZSc6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCchIURvd25sb2FkIFtDT0xPUiBzZWFibHVlXUF1ZGlvISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTI0Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgZWxpZiB1cmwuc3RhcnRzd2l0aCgnbWFnbmV0Oj94dD0nKSBvciAnLnRvcnJlbnQnIGluIHVybDoKICAgICAgICAgIAogICAgICAgICAgICBpZiAnJicgaW4gdXJsIGFuZCBub3QgJyZhbXA7JyBpbiB1cmwgOgogICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJyYnLCcmYW1wOycpCiAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL3BsYXk/dXJpPScgKyB1cmwKICAgICAgICAgICAgbW9kZSA9ICcxMicKICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgZWxzZTogCiAgICAgICAgICAgIG1vZGUgPSAnMTInCiAgICAgIAogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkgICAgICAgICAgIAogICAgICAgIHU9c3lzLmFyZ3ZbMF0rIj8iCiAgICAgICAgcGxheV9saXN0ID0gRmFsc2UKICAgICAgCiAgICAgICAgaWYgcGxheWxpc3Q6CiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6CiAgICAgICAgICAgICAgICB1ICs9ICJ1cmw9Iit1cmxsaWIucXVvdGVfcGx1cyh1cmwpKyImbW9kZT0iK21vZGUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHUgKz0gIm1vZGU9MTMmbmFtZT0lcyZwbGF5bGlzdD0lcyIgJSh1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSwgdXJsbGliLnF1b3RlX3BsdXMoc3RyKHBsYXlsaXN0KS5yZXBsYWNlKCcsJywnfHwnKSkpCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZSArICdbQ09MT1IgbWFnZW50YV0gKCcgKyBzdHIobGVuKHBsYXlsaXN0KSkgKyAnIGl0ZW1zIClbL0NPTE9SXScKICAgICAgICAgICAgICAgIHBsYXlfbGlzdCA9IFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICB1ICs9ICJ1cmw9Iit1cmxsaWIucXVvdGVfcGx1cyh1cmwpKyImbW9kZT0iK21vZGUKICAgICAgICBpZiByZWdleHM6CiAgICAgICAgICAgIHUgKz0gIiZyZWdleHM9IityZWdleHMKICAgICAgICBpZiBub3Qgc2V0Q29va2llID09ICcnOgogICAgICAgICAgICB1ICs9ICImc2V0Q29va2llPSIrdXJsbGliLnF1b3RlX3BsdXMoc2V0Q29va2llKQogIAogICAgICAgIGlmIGRhdGUgPT0gJyc6CiAgICAgICAgICAgIGRhdGUgPSBOb25lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gJ1xuXG5EYXRlOiAlcycgJWRhdGUKICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpCiAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPXsgIlRpdGxlIjogbmFtZSwgIlBsb3QiOiBkZXNjcmlwdGlvbiwgIkdlbnJlIjogZ2VucmUsICJkYXRlYWRkZWQiOiBkYXRlIH0pCiAgICAgICAgbGl6LnNldFByb3BlcnR5KCJGYW5hcnRfSW1hZ2UiLCBmYW5hcnQpCiAgICAgICAgCiAgICAgICAgaWYgKG5vdCBwbGF5X2xpc3QpIGFuZCBub3QgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpOiMgIChub3QgdXJsLnN0YXJ0c3dpdGgoJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXInKSk6CiAgICAgICAgICAgIGlmIHJlZ2V4czoKICAgICAgICAgICAgICAgIGlmICckcHlGdW5jdGlvbjpwbGF5bWVkaWEoJyBub3QgaW4gdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpIGFuZCAnbm90cGxheWFibGUnIG5vdCBpbiB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykgIDoKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3NldHRpbmcgaXNwbGF5YWJsZScsdXJsLCB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cyksdXJsCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdJc1BsYXlhYmxlJywgJ3RydWUnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdJc1BsYXlhYmxlJywgJ3RydWUnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFkZG9uX2xvZyggJ05PVCBzZXR0aW5nIGlzcGxheWFibGUnK3VybCkKICAgICAgIAogICAgICAgIGlmIHNob3djb250ZXh0OgogICAgICAgICAgICBjb250ZXh0TWVudSA9IFtdCiAgICAgICAgICAgIGlmIHNob3djb250ZXh0ID09ICdmYXYnOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICgnUmVtb3ZlIGZyb20gQWRkLW9uIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NiZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKQogICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsaWYgbm90IG5hbWUgaW4gRkFWOgogICAgICAgICAgICAgICAgZmF2X3BhcmFtcyA9ICgKICAgICAgICAgICAgICAgICAgICAnJXM/bW9kZT01Jm5hbWU9JXMmdXJsPSVzJmljb25pbWFnZT0lcyZmYW5hcnQ9JXMmZmF2X21vZGU9MCcKICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlKSwgdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KSkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiBwbGF5bGlzdDoKICAgICAgICAgICAgICAgICAgICBmYXZfcGFyYW1zICs9ICdwbGF5bGlzdD0nK3VybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpCiAgICAgICAgICAgICAgICBpZiByZWdleHM6CiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyArPSAiJnJlZ2V4cz0iK3JlZ2V4cwogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQWRkIHRvIEFkZC1vbiBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcyknICVmYXZfcGFyYW1zKSkKICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnUpCiAgICAgICAKICAgICAgICBpZiBub3QgcGxheWxpc3QgaXMgTm9uZToKICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYWRkX3BsYXlsaXN0JykgPT0gImZhbHNlIjoKICAgICAgICAgICAgICAgIHBsYXlsaXN0X25hbWUgPSBuYW1lLnNwbGl0KCcpICcpWzFdCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudV8gPSBbCiAgICAgICAgICAgICAgICAgICAgKCdQbGF5ICcrcGxheWxpc3RfbmFtZSsnIFBsYXlMaXN0JywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT0xMyZuYW1lPSVzJnBsYXlsaXN0PSVzKScKICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMocGxheWxpc3RfbmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpKSkKICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnVfKQogICAgICAgICNwcmludCAnYWRkaW5nJyxuYW1lCiAjICAgICAgIHByaW50IHVybCx0b3RhbGl0ZW1zCiAgICAgICAgb2s9eGJtY3BsdWdpbi5hZGREaXJlY3RvcnlJdGVtKGhhbmRsZT1pbnQoc3lzLmFyZ3ZbMV0pLHVybD11LGxpc3RpdGVtPWxpeix0b3RhbEl0ZW1zPXRvdGFsKQogICAgICAgICNwcmludCAnYWRkZWQnLG5hbWUKICAgICAgICByZXR1cm4gb2sKCmRlZiBwbGF5c2V0cmVzb2x2ZWQodXJsLG5hbWUsaWNvbmltYWdlLHNldHJlc29sdmVkPVRydWUpOgogICAgaWYgc2V0cmVzb2x2ZWQ6CiAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlKQogICAgICAgIGxpei5zZXRJbmZvKHR5cGU9J1ZpZGVvJywgaW5mb0xhYmVscz17J1RpdGxlJzpuYW1lfSkKICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikKICAgICAgICBsaXouc2V0UGF0aChzdHIodXJsKSkKICAgICAgICB4Ym1jcGx1Z2luLnNldFJlc29sdmVkVXJsKGludChzeXMuYXJndlsxXSksIFRydWUsIGxpeikKICAgIGVsc2U6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignWEJNQy5SdW5QbHVnaW4oJyt1cmwrJyknKSAgICAgIAoKCiMjIFRoYW5rcyB0byBkYXNjaGFja2EsIGFuIGVwZyBzY3JhcGVyIGZvciBodHRwOi8vaS50ZWxlYm95LmNoL3Byb2dyYW1tL3N0YXRpb25fc2VsZWN0LnBocAojIyAgaHR0cDovL2ZvcnVtLnhibWMub3JnL3Bvc3QucGhwP3A9OTM2MjI4JnBvc3Rjb3VudD0xMDc2CmRlZiBnZXRlcGcobGluayk6CiAgICAgICAgdXJsPXVybGxpYi51cmxvcGVuKGxpbmspCiAgICAgICAgc291cmNlPXVybC5yZWFkKCkKICAgICAgICB1cmwuY2xvc2UoKQogICAgICAgIHNvdXJjZTIgPSBzb3VyY2Uuc3BsaXQoIkpldHp0IikKICAgICAgICBzb3VyY2UzID0gc291cmNlMlsxXS5zcGxpdCgncHJvZ3JhbW0vZGV0YWlsLnBocD9jb25zdF9pZD0nKQogICAgICAgIHNvdXJjZXVocnplaXQgPSBzb3VyY2UzWzFdLnNwbGl0KCc8YnIgLz48YSBocmVmPSIvJykKICAgICAgICBub3d0aW1lID0gc291cmNldWhyemVpdFswXVs0MDpsZW4oc291cmNldWhyemVpdFswXSldCiAgICAgICAgc291cmNldGl0bGUgPSBzb3VyY2UzWzJdLnNwbGl0KCI8L2E+PC9wPjwvZGl2PiIpCiAgICAgICAgbm93dGl0bGUgPSBzb3VyY2V0aXRsZVswXVsxNzpsZW4oc291cmNldGl0bGVbMF0pXQogICAgICAgIG5vd3RpdGxlID0gbm93dGl0bGUuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgcmV0dXJuICIgIC0gIitub3d0aXRsZSsiIC0gIitub3d0aW1lCgoKZGVmIGdldF9lcGcodXJsLCByZWdleCk6CiAgICAgICAgZGF0YSA9IG1ha2VSZXF1ZXN0KHVybCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGl0ZW0gPSByZS5maW5kYWxsKHJlZ2V4LCBkYXRhKVswXQogICAgICAgICAgICByZXR1cm4gaXRlbQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgYWRkb25fbG9nKCdyZWdleCBmYWlsZWQnKQogICAgICAgICAgICBhZGRvbl9sb2cocmVnZXgpCiAgICAgICAgICAgIHJldHVybgoKCnhibWNwbHVnaW4uc2V0Q29udGVudChpbnQoc3lzLmFyZ3ZbMV0pLCAnbW92aWVzJykKCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX1VOU09SVEVEKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0xBQkVMKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0RBVEUpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfR0VOUkUpCmV4Y2VwdDoKICAgIHBhc3MKCnBhcmFtcz1nZXRfcGFyYW1zKCkKCnVybD1Ob25lCm5hbWU9Tm9uZQptb2RlPU5vbmUKcGxheWxpc3Q9Tm9uZQppY29uaW1hZ2U9Tm9uZQpmYW5hcnQ9RkFOQVJUCnBsYXlsaXN0PU5vbmUKZmF2X21vZGU9Tm9uZQpyZWdleHM9Tm9uZQoKdHJ5OgogICAgdXJsPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJ1cmwiXSkuZGVjb2RlKCd1dGYtOCcpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgbmFtZT11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sibmFtZSJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIGljb25pbWFnZT11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1siaWNvbmltYWdlIl0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgZmFuYXJ0PXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJmYW5hcnQiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBtb2RlPWludChwYXJhbXNbIm1vZGUiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBwbGF5bGlzdD1ldmFsKHVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJwbGF5bGlzdCJdKS5yZXBsYWNlKCd8fCcsJywnKSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBmYXZfbW9kZT1pbnQocGFyYW1zWyJmYXZfbW9kZSJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHJlZ2V4cz1wYXJhbXNbInJlZ2V4cyJdCmV4Y2VwdDoKICAgIHBhc3MKCmFkZG9uX2xvZygiTW9kZTogIitzdHIobW9kZSkpCmlmIG5vdCB1cmwgaXMgTm9uZToKICAgIGFkZG9uX2xvZygiVVJMOiAiK3N0cih1cmwuZW5jb2RlKCd1dGYtOCcpKSkKYWRkb25fbG9nKCJOYW1lOiAiK3N0cihuYW1lKSkKCmlmIG1vZGU9PU5vbmU6CiAgICBhZGRvbl9sb2coIkluZGV4IikKICAgIFNLaW5kZXgoKQkKCmVsaWYgbW9kZT09MToKICAgIGFkZG9uX2xvZygiZ2V0RGF0YSIpCiAgICBnZXREYXRhKHVybCxmYW5hcnQpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTI6CiAgICBhZGRvbl9sb2coImdldENoYW5uZWxJdGVtcyIpCiAgICBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0zOgogICAgYWRkb25fbG9nKCJnZXRTdWJDaGFubmVsSXRlbXMiKQogICAgZ2V0U3ViQ2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09NDoKICAgIGFkZG9uX2xvZygiZ2V0RmF2b3JpdGVzIikKICAgIGdldEZhdm9yaXRlcygpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTU6CiAgICBhZGRvbl9sb2coImFkZEZhdm9yaXRlIikKICAgIHRyeToKICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnXFwgJylbMV0KICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICB0cnk6CiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJyAgLSAnKVswXQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKICAgIGFkZEZhdm9yaXRlKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsZmF2X21vZGUpCgplbGlmIG1vZGU9PTY6CiAgICBhZGRvbl9sb2coInJtRmF2b3JpdGUiKQogICAgdHJ5OgogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCdcXCAnKVsxXQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKICAgIHRyeToKICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnICAtICcpWzBdCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgcm1GYXZvcml0ZShuYW1lKQoKZWxpZiBtb2RlPT03OgogICAgYWRkb25fbG9nKCJhZGRTb3VyY2UiKQogICAgYWRkU291cmNlKHVybCkKCmVsaWYgbW9kZT09ODoKICAgIGFkZG9uX2xvZygicm1Tb3VyY2UiKQogICAgcm1Tb3VyY2UobmFtZSkKCmVsaWYgbW9kZT09OToKICAgIGFkZG9uX2xvZygiZG93bmxvYWRfZmlsZSIpCiAgICBkb3dubG9hZF9maWxlKG5hbWUsIHVybCkKCmVsaWYgbW9kZT09MTA6CiAgICBhZGRvbl9sb2coImdldENvbW11bml0eVNvdXJjZXMiKQogICAgZ2V0Q29tbXVuaXR5U291cmNlcygpCgplbGlmIG1vZGU9PTExOgogICAgYWRkb25fbG9nKCJhZGRTb3VyY2UiKQogICAgYWRkU291cmNlKHVybCkKCmVsaWYgbW9kZT09MTI6CiAgICBhZGRvbl9sb2coInNldFJlc29sdmVkVXJsIikKICAgIGlmIG5vdCB1cmwuc3RhcnRzd2l0aCgicGx1Z2luOi8vcGx1Z2luIikgb3Igbm90IGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKTojbm90IHVybC5zdGFydHN3aXRoKCJwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyIikgOgogICAgICAgIGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKHBhdGg9dXJsKQogICAgICAgIHhibWNwbHVnaW4uc2V0UmVzb2x2ZWRVcmwoaW50KHN5cy5hcmd2WzFdKSwgVHJ1ZSwgaXRlbSkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQgJ05vdCBzZXR0aW5nIHNldFJlc29sdmVkVXJsJwogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ1hCTUMuUnVuUGx1Z2luKCcrdXJsKycpJykKCgplbGlmIG1vZGU9PTEzOgogICAgYWRkb25fbG9nKCJwbGF5X3BsYXlsaXN0IikKICAgIHBsYXlfcGxheWxpc3QobmFtZSwgcGxheWxpc3QpCgplbGlmIG1vZGU9PTE0OgogICAgYWRkb25fbG9nKCJnZXRfeG1sX2RhdGFiYXNlIikKICAgIGdldF94bWxfZGF0YWJhc2UodXJsKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0xNToKICAgIGFkZG9uX2xvZygiYnJvd3NlX3htbF9kYXRhYmFzZSIpCiAgICBnZXRfeG1sX2RhdGFiYXNlKHVybCwgVHJ1ZSkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MTY6CiAgICBhZGRvbl9sb2coImJyb3dzZV9jb21tdW5pdHkiKQogICAgZ2V0Q29tbXVuaXR5U291cmNlcyhUcnVlKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0xNzoKICAgIGFkZG9uX2xvZygiZ2V0UmVnZXhQYXJzZWQiKQogICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwpCiAgICBpZiB1cmw6CiAgICAgICAgcGxheXNldHJlc29sdmVkKHVybCxuYW1lLGljb25pbWFnZSxzZXRyZXNvbHZlZCkKICAgIGVsc2U6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oU2t5bmV0ICxGYWlsZWQgdG8gZXh0cmFjdCByZWdleC4gLSAiKyJ0aGlzIisiLDQwMDAsIitpY29uKyIpIikKZWxpZiBtb2RlPT0xODoKICAgIGFkZG9uX2xvZygieW91dHViZWRsIikKICAgIHRyeToKICAgICAgICBpbXBvcnQgeW91dHViZWRsCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKFNreW5ldCxQbGVhc2UgW0NPTE9SIHllbGxvd11pbnN0YWxsIHRoZSBZb3V0dWJlIEFkZG9uWy9DT0xPUl0gbW9kdWxlICwxMDAwMCwiIikiKQogICAgc3RyZWFtX3VybD15b3V0dWJlZGwuc2luZ2xlX1lEKHVybCkKICAgIHBsYXlzZXRyZXNvbHZlZChzdHJlYW1fdXJsLG5hbWUsaWNvbmltYWdlKQplbGlmIG1vZGU9PTE5OgoJYWRkb25fbG9nKCJHZW5lc2lzY29tbW9ucmVzb2x2ZXJzIikKCXBsYXlzZXRyZXNvbHZlZCAodXJsc29sdmVyKHVybCksbmFtZSxpY29uaW1hZ2UsVHJ1ZSkJCgplbGlmIG1vZGU9PTIxOgogICAgYWRkb25fbG9nKCJkb3dubG9hZCBjdXJyZW50IGZpbGUgdXNpbmcgeW91dHViZS1kbCBzZXJ2aWNlIikKICAgIHl0ZGxfZG93bmxvYWQoJycsbmFtZSwndmlkZW8nKQplbGlmIG1vZGU9PTIzOgogICAgYWRkb25fbG9nKCJnZXQgaW5mbyB0aGVuIGRvd25sb2FkIikKICAgIHl0ZGxfZG93bmxvYWQodXJsLG5hbWUsJ3ZpZGVvJykgCmVsaWYgbW9kZT09MjQ6CiAgICBhZGRvbl9sb2coIkF1ZGlvIG9ubHkgeW91dHViZSBkb3dubG9hZCIpCiAgICB5dGRsX2Rvd25sb2FkKHVybCxuYW1lLCdhdWRpbycpCmVsaWYgbW9kZT09MjU6CiAgICBhZGRvbl9sb2coIllvdVR1YmUvRE1vdGlvbiIpCiAgICBzZWFyY2godXJsKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQplbGlmIG1vZGU9PTI2OgogICAgYWRkb25fbG9nKCJZb3VUdWJlL0RNb3Rpb24gRnJvbSBTZWFyY2ggSGlzdG9yeSIpCiAgICBuYW1lID0gbmFtZS5zcGxpdCgnOicpCiAgICBzZWFyY2godXJsLHNlYXJjaF90ZXJtPW5hbWVbMV0pCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCmVsaWYgbW9kZT09Mjc6CiAgICBhZGRvbl9sb2coIlVzaW5nIElNREIgaWQgdG8gcGxheSBpbiBQdWxzYXIiKQogICAgcHVsc2FySU1EQj1zZWFyY2godXJsKQogICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHB1bHNhcklNREIpIAplbGlmIG1vZGU9PTMwOgogICAgR2V0U3VibGlua3MobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCkKZWxpZiBtb2RlPT0zMToKICAgIFdpekhETWVudSh1cmwsaWNvbmltYWdlLGZhbmFydCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKZWxpZiBtb2RlPT0zMjoKCVdpel9HZXRfdXJsKHVybCkKCXhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkJCgkKZWxpZiBtb2RlPT00MDoKICAgIFNlYXJjaENoYW5uZWxzKCkKICAgIFNldFZpZXdUaHVtYm5haWwoKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQplbGlmIG1vZGUgPT0gNDEgOiAKICAgIFNlYXJjaF9pbnB1dCh1cmwpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgkKZWxpZiBtb2RlPT01MzoKICAgIGFkZG9uX2xvZygiUmVxdWVzdGluZyBKU09OLVJQQyBJdGVtcyIpCiAgICBwbHVnaW5xdWVyeWJ5SlNPTih1cmwpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkp')